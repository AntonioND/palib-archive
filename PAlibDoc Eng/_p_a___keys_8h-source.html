<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PAlib: PA_Keys.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<h1>PA_Keys.h</h1><a href="_p_a___keys_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef _PA_KEYS</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define _PA_KEYS</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span>
<a name="l00004"></a>00004 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00005"></a>00005 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
<a name="l00006"></a>00006 <span class="preprocessor">#endif</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span>
<a name="l00008"></a>00008 <span class="preprocessor">#include "PA9.h"</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">// Système pour les touches</span>
<a name="l00017"></a>00017 <span class="comment"></span>
<a name="l00018"></a>00018 <span class="comment">// Keyboard defines</span>
<a name="l00019"></a>00019 <span class="preprocessor">#define PA_BACKSPACE 1    // On va dire que la touche backspace a pour valeur 1...</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#define PA_CAPS      2    // 2 pour CAPS</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#define PA_ENTER     '\n'    // 3 pour Enter</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#define PA_SHIFT     4    // etc</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#define PA_RIEN      0    // Si y'a rien, faudra faire comme si on appuye sur rien</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="preprocessor">#define PA_TAB       3    // tab...</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span>
<a name="l00026"></a>00026 <span class="comment">// Stylus and Pad definitions, will be used by the arm7 to auto-update positions...</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00029"></a>00029    u8 A, B, X, Y, L, R, Up, Down, Right, Left, Start, Select, Anykey;
<a name="l00030"></a>00030 } PA_Pad;
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00033"></a>00033    PA_Pad Held, Released, Newpress; <span class="comment">// Pressed si on appuye, Held si on garde appuyé, et Released si on relache</span>
<a name="l00034"></a>00034 } Pads;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00037"></a>00037    u8 Held, Released, Newpress, Newpress0;
<a name="l00038"></a>00038    s16 X, Y, altX, altY, Pressure, Vx, Vy, oldVx, oldVy, Downtime, Uptime, DblClick;
<a name="l00039"></a>00039 } PA_Stylus;
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="keyword">extern</span> PA_Stylus Stylus;
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="keyword">extern</span> Pads Pad;
<a name="l00045"></a>00045 <span class="keyword">extern</span> PA_Pad* PadPointer;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="comment">// Structure pour les sprites que l'on déplace...</span>
<a name="l00048"></a>00048 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00049"></a>00049        u8 Moving;
<a name="l00050"></a>00050        u8 Sprite;
<a name="l00051"></a>00051        s16 X, Y, Vx, Vy, NextVx, NextVy;
<a name="l00052"></a>00052        u8 Time; <span class="comment">// Si trop longtemps sans bouger le sprite, il décroche...</span>
<a name="l00053"></a>00053 } PA_movingsprite;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="keyword">extern</span> PA_movingsprite PA_MovedSprite;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="keyword">extern</span> u8 PA_MoveSpriteType; 
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="comment">// Button info</span>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="comment">/*</span>
<a name="l00067"></a>00067 <span class="comment">#define PA_UpdatePad() ExPad = CompletePad;\</span>
<a name="l00068"></a>00068 <span class="comment">   CompletePad = ~(BUTTONS + (((IPC-&gt;buttons)&amp;3) &lt;&lt; 10));\</span>
<a name="l00069"></a>00069 <span class="comment">   UPDATEPAD(Pad.Held, CompletePad);\</span>
<a name="l00070"></a>00070 <span class="comment">   UPDATEPAD(Pad.Released, (ExPad &amp; (~CompletePad)));\</span>
<a name="l00071"></a>00071 <span class="comment">   UPDATEPAD(Pad.Newpress, (CompletePad &amp; (~ExPad)));</span>
<a name="l00072"></a>00072 <span class="comment"></span>
<a name="l00073"></a>00073 <span class="comment">#define PA_UpdateStylus() u8 temp = ((~IPC-&gt;buttons) &gt;&gt; 6) &amp; 1;\</span>
<a name="l00074"></a>00074 <span class="comment">       Stylus.Newpress = temp &amp; (!Stylus.Held);\</span>
<a name="l00075"></a>00075 <span class="comment">       Stylus.Released = (!temp) &amp; Stylus.Held;\</span>
<a name="l00076"></a>00076 <span class="comment">       Stylus.Held = temp;\</span>
<a name="l00077"></a>00077 <span class="comment">       if(Stylus.Held)Stylus.altX =  ((IPC-&gt;touchX - 0x0113) / 14);\</span>
<a name="l00078"></a>00078 <span class="comment">       if(Stylus.Held)Stylus.altY =  ((IPC-&gt;touchY - 0x00E0) / 19);\</span>
<a name="l00079"></a>00079 <span class="comment">       if(Stylus.Held)Stylus.X =  IPC-&gt;touchXpx;\</span>
<a name="l00080"></a>00080 <span class="comment">       if(Stylus.Held)Stylus.Y =  IPC-&gt;touchYpx;\</span>
<a name="l00081"></a>00081 <span class="comment">       if(Stylus.Held)Stylus.Pressure = (((Stylus.X * IPC-&gt;touchZ2) &gt;&gt; 6) / IPC-&gt;touchZ1) - (Stylus.X &gt;&gt; 6);</span>
<a name="l00082"></a>00082 <span class="comment">*/</span>
<a name="l00083"></a>00083 <span class="comment">//#define BUTTON_AND 16384</span>
<a name="l00084"></a>00084 <span class="comment">//#define BUTTON_OR 0</span>
<a name="l00085"></a>00085 
<a name="l00099"></a>00099 <span class="keywordtype">void</span> <a class="code" href="group___keys.html#g6ebcd54f6f4d30672d0b5614c1d3b0ce">PA_UpdatePad</a>(<span class="keywordtype">void</span>);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 
<a name="l00109"></a>00109 <span class="keywordtype">void</span> <a class="code" href="group___keys.html#g7a1b0b3498630e595af60ec656a258a8">PA_UpdateStylus</a>(<span class="keywordtype">void</span>);
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 
<a name="l00120"></a>00120 u8 <a class="code" href="group___keys.html#gc8118f627bd0af3e9f5895e7c0f13db7">PA_MoveSpritePix</a>(u8 sprite);
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 
<a name="l00136"></a><a class="code" href="group___keys.html#gdca042bc805ff171828274782abde43d">00136</a> <span class="preprocessor">#define PA_MoveSprite(sprite) PA_MoveSpriteEx(PA_Screen, sprite, PA_GetSpriteLx(0, sprite), PA_GetSpriteLy(0, sprite))</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span>
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 
<a name="l00157"></a>00157 u8 <a class="code" href="group___keys.html#g6260f4cd6762e1858ee4624028336405">PA_MoveSpriteEx</a>(u8 screen, u8 sprite, u8 lx, u8 ly);
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 
<a name="l00171"></a><a class="code" href="group___keys.html#ga711b5de65ba948f1df9aa02ea3f1226">00171</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___keys.html#ga711b5de65ba948f1df9aa02ea3f1226">PA_MoveSpriteDistance</a>(u8 sprite, u8 distance){
<a name="l00172"></a>00172        PA_MoveSpriteType = 1; <span class="comment">// mode distance</span>
<a name="l00173"></a>00173        u8 touched = <a class="code" href="group___keys.html#g6260f4cd6762e1858ee4624028336405">PA_MoveSpriteEx</a>(PA_Screen, sprite, distance, distance);
<a name="l00174"></a>00174        PA_MoveSpriteType = 0; <span class="comment">// normal mode</span>
<a name="l00175"></a>00175        <span class="keywordflow">return</span> touched;
<a name="l00176"></a>00176 }
<a name="l00177"></a>00177 <span class="comment">/*</span>
<a name="l00184"></a>00184 <span class="comment">extern inline void PA_UpdateMoveSprite(void) {</span>
<a name="l00185"></a>00185 <span class="comment">       PA_MovedSprite.Time++;</span>
<a name="l00186"></a>00186 <span class="comment">       if ((PA_MovedSprite.Time &gt; 2) || Stylus.Released) {</span>
<a name="l00187"></a>00187 <span class="comment">              PA_MovedSprite.Moving = 0;</span>
<a name="l00188"></a>00188 <span class="comment">              PA_MovedSprite.Time = 0;</span>
<a name="l00189"></a>00189 <span class="comment">       }</span>
<a name="l00190"></a>00190 <span class="comment">}*/</span>
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 
<a name="l00208"></a><a class="code" href="group___keys.html#g3fb118bf97ac088d640191392fa202b2">00208</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___keys.html#g3fb118bf97ac088d640191392fa202b2">PA_SpriteStylusOverEx</a>(u8 sprite, u8 lx, u8 ly){
<a name="l00209"></a>00209        <span class="keywordflow">return</span> ((Stylus.X &gt; <a class="code" href="group___sprite.html#g353097a994619fb54e46b8fff6eb15ca">PA_GetSpriteX</a>(PA_Screen, sprite)) &amp;&amp; (Stylus.X &lt; <a class="code" href="group___sprite.html#g353097a994619fb54e46b8fff6eb15ca">PA_GetSpriteX</a>(PA_Screen, sprite) + lx)&amp;&amp; (Stylus.Y &gt; <a class="code" href="group___sprite.html#gbe6706a941e65ac879edb4c0422967bb">PA_GetSpriteY</a>(PA_Screen, sprite)) &amp;&amp; (Stylus.Y &lt; <a class="code" href="group___sprite.html#gbe6706a941e65ac879edb4c0422967bb">PA_GetSpriteY</a>(PA_Screen, sprite) + ly));
<a name="l00210"></a>00210 }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 
<a name="l00229"></a><a class="code" href="group___keys.html#gab4bc5f7d5ca77aab036159812e2ac69">00229</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___keys.html#gab4bc5f7d5ca77aab036159812e2ac69">PA_SpriteTouchedEx</a>(u8 sprite, u8 lx, u8 ly){
<a name="l00230"></a>00230        <span class="keywordflow">return</span> (Stylus.Held &amp;&amp; <a class="code" href="group___keys.html#g3fb118bf97ac088d640191392fa202b2">PA_SpriteStylusOverEx</a>(sprite, lx, ly));
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 
<a name="l00234"></a>00234 
<a name="l00243"></a><a class="code" href="group___keys.html#gbf97dc88160e7433707434ceac42217a">00243</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___keys.html#gbf97dc88160e7433707434ceac42217a">PA_SpriteTouched</a>(u8 sprite) {
<a name="l00244"></a>00244        <span class="keywordflow">return</span> <a class="code" href="group___keys.html#gab4bc5f7d5ca77aab036159812e2ac69">PA_SpriteTouchedEx</a>(sprite, <a class="code" href="group___sprite.html#g8b3a167e67ef84d36ce6b8a1d100c1ef">PA_GetSpriteLx</a>(PA_Screen, sprite), <a class="code" href="group___sprite.html#g6eb6db7837dfc5b7c7aefb30e0f4f680">PA_GetSpriteLy</a>(PA_Screen, sprite));
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 
<a name="l00248"></a>00248 
<a name="l00257"></a><a class="code" href="group___keys.html#g2e55f14da05b60cd2a1d767448e28e07">00257</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___keys.html#g2e55f14da05b60cd2a1d767448e28e07">PA_SpriteStylusOver</a>(u8 sprite) {
<a name="l00258"></a>00258        <span class="keywordflow">return</span> <a class="code" href="group___keys.html#g3fb118bf97ac088d640191392fa202b2">PA_SpriteStylusOverEx</a>(sprite, <a class="code" href="group___sprite.html#g8b3a167e67ef84d36ce6b8a1d100c1ef">PA_GetSpriteLx</a>(PA_Screen, sprite), <a class="code" href="group___sprite.html#g6eb6db7837dfc5b7c7aefb30e0f4f680">PA_GetSpriteLy</a>(PA_Screen, sprite));
<a name="l00259"></a>00259 }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 
<a name="l00262"></a>00262 
<a name="l00263"></a>00263 <span class="keyword">extern</span> <span class="keyword">inline</span> u8 PA_SpriteTouchedPix(u8 sprite){
<a name="l00264"></a>00264        s16 spritex = <a class="code" href="group___sprite.html#g353097a994619fb54e46b8fff6eb15ca">PA_GetSpriteX</a>(PA_Screen, sprite);
<a name="l00265"></a>00265        s16 spritey = <a class="code" href="group___sprite.html#gbe6706a941e65ac879edb4c0422967bb">PA_GetSpriteY</a>(PA_Screen, sprite);
<a name="l00266"></a>00266        <span class="keywordflow">if</span> (spritex &gt;= 458) spritex -=511; <span class="comment">// normalize the X coordinate...</span>
<a name="l00267"></a>00267        <span class="keywordflow">if</span> (spritey &gt;= 220) spritey -=256; <span class="comment">// normalize the y coordinate...</span>
<a name="l00268"></a>00268        u16 x = Stylus.X - spritex;
<a name="l00269"></a>00269        u16 y = Stylus.Y - spritey;
<a name="l00270"></a>00270        
<a name="l00271"></a>00271        <span class="keywordflow">return</span> (Stylus.Held &amp;&amp; (x &lt; spriteanims[PA_Screen][sprite].lx) &amp;&amp; (y &lt; spriteanims[PA_Screen][sprite].ly) &amp;&amp; <a class="code" href="group___sprite.html#gad5e8a20aa850a13896740dcd93a5fcc">PA_GetSpritePixel</a>(PA_Screen, sprite, x, y));
<a name="l00272"></a>00272 }
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="keyword">extern</span> <span class="keyword">inline</span> u8 PA_Sprite16cTouchedPix(u8 sprite){
<a name="l00276"></a>00276        s16 spritex = <a class="code" href="group___sprite.html#g353097a994619fb54e46b8fff6eb15ca">PA_GetSpriteX</a>(PA_Screen, sprite);
<a name="l00277"></a>00277        s16 spritey = <a class="code" href="group___sprite.html#gbe6706a941e65ac879edb4c0422967bb">PA_GetSpriteY</a>(PA_Screen, sprite);
<a name="l00278"></a>00278        <span class="keywordflow">if</span> (spritex &gt;= 458) spritex -=511; <span class="comment">// normalize the X coordinate...</span>
<a name="l00279"></a>00279        <span class="keywordflow">if</span> (spritey &gt;= 220) spritey -=256; <span class="comment">// normalize the y coordinate...</span>
<a name="l00280"></a>00280        u16 x = Stylus.X - spritex;
<a name="l00281"></a>00281        u16 y = Stylus.Y - spritey;
<a name="l00282"></a>00282        
<a name="l00283"></a>00283        <span class="keywordflow">return</span> (Stylus.Held &amp;&amp; (x &lt; spriteanims[PA_Screen][sprite].lx) &amp;&amp; (y &lt; spriteanims[PA_Screen][sprite].ly) &amp;&amp; <a class="code" href="group___sprite.html#gf11d2dd56dad1ad2e8023e79c03efb41">PA_GetSprite16cPixel</a>(PA_Screen, sprite, x, y));
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00303"></a><a class="code" href="group___keys.html#g9433372a42c248a4ea8c2f73144f9bc6">00303</a> <span class="preprocessor">#define PA_StylusInZone(x1, y1, x2, y2) ((Stylus.X&gt;=x1)&amp;&amp;(Stylus.Y&gt;=y1)&amp;&amp;(Stylus.X&lt;x2)&amp;&amp;(Stylus.Y&lt;y2))</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span> <span class="comment">// end of Keys</span>
<a name="l00306"></a>00306 
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 
<a name="l00309"></a>00309 
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00319"></a>00319 <span class="preprocessor"></span>}
<a name="l00320"></a>00320 <span class="preprocessor">#endif</span>
<a name="l00321"></a>00321 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jan 30 23:00:22 2007 for PAlib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>
