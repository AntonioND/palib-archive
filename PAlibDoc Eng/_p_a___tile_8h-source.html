<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PAlib: PA_Tile.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>PA_Tile.h</h1><a href="_p_a___tile_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef _PA_Tile</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define _PA_Tile</span>
00003 <span class="preprocessor"></span>
00004 
00005 <span class="preprocessor">#include "<a class="code" href="_p_a___sprite_8h.html">PA_Sprite.h</a>"</span>
00006 
00007 
00008 <span class="comment">// Extracts the size from PAGfx convertions</span>
00009 <span class="keyword">extern</span> <span class="keyword">inline</span> u8 PA_GetPAGfxBgSize(u16 width, u16 height)
00010 {
00011        u8 bg_size = 0;
00012        <span class="keywordflow">if</span> (height == 512)   bg_size = 2;
00013        <span class="keywordflow">if</span> (width == 512)    bg_size ++;   
00014        <span class="keywordflow">return</span> bg_size;
00015 }
00016 
00017 <span class="comment">// Extracts the size from PAGfx convertions</span>
00018 <span class="keyword">extern</span> <span class="keyword">inline</span> u8 PA_GetPAGfxRotBgSize(u16 width)
00019 {
00020        u8 bg_size = 1; <span class="comment">//256x256 by default</span>
00021        <span class="keywordflow">if</span> (width &lt;= 128)    bg_size = 0;  
00022        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (width &lt;= 256)      bg_size = 1;  
00023        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (width &lt;= 512)      bg_size = 2;         
00024        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (width &lt;= 1024) bg_size = 3;             
00025        
00026        <span class="keywordflow">return</span> bg_size;
00027 }
00028 
00035 <span class="comment">//#include "../PA.h"</span>
00036 
00037 
00038 
00040 <span class="comment">// Système de Tiles</span>
00042 <span class="comment"></span>
00043 
00044 <span class="comment">//background memory offset macros</span>
00045 <span class="preprocessor">#define CharBaseBlock(screen, n) (((n)*0x4000) + 0x6000000 + (0x200000 *  screen))</span>
00046 <span class="preprocessor"></span><span class="preprocessor">#define ScreenBaseBlock(screen, n) (((n)*0x800) + 0x6000000 + (0x200000 *  screen))</span>
00047 <span class="preprocessor"></span><span class="keyword">extern</span> u32 PA_bgmap[2][4]; <span class="comment">// Pointeur vers les maps, 4 maps par screen</span>
00048 <span class="keyword">extern</span> u8 tilesetchar[2][4];
00049 
00050 <span class="comment">// Quantité de données à charger en fonction de la taille de la map...</span>
00051 <span class="keyword">extern</span> u16 bg_sizes[4];
00052 <span class="keyword">extern</span> u8 bg_place[4];
00053 
00054 <span class="keyword">extern</span> u16 *PA_DrawBg[2]; <span class="comment">// Fond dessinable</span>
00055 
00056 
00057 <span class="keyword">extern</span> u8 charblocks[2][70];
00058 <span class="keyword">extern</span> u16 tilesetsize[2][4]; <span class="comment">// Place utilisée pour chaque tileset</span>
00059 <span class="keyword">extern</span> u16 mapsize[2][4]; <span class="comment">// Place utilisée pour chaque map</span>
00060 <span class="keyword">extern</span> u8 tilesetchar[2][4];  <span class="comment">// Emplacement mémoire de chaque tileset</span>
00061 <span class="keyword">extern</span> u8 mapchar[2][4];  <span class="comment">// Emplacement mémoire de chaque map</span>
00062 
00063 <span class="keyword">extern</span> u8 charsetstart[2];
00064 
00065 
00066 
00067 
00068 
00069 <span class="keyword">extern</span> s32 PA_parallaxX[2][4];
00070 <span class="keyword">extern</span> s32 PA_parallaxY[2][4];
00071 
00072 
00073 
00074 
00075 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00076        u8 infscroll; <span class="comment">// Passe à 1 si scrolling infini activé...</span>
00077        u16* bg_map; <span class="comment">// Map</span>
00078 <span class="comment">//     s32 x, y;</span>
00079        s32 lx, ly;
00080        s32 scrollx, scrolly;
00081        s32 maxx; <span class="comment">// 32 ou 64, en fonction de la largeur...</span>
00082 <span class="comment">//     s32 startx, starty;</span>
00083 }scrollpositions;
00084 
00085 <span class="keyword">extern</span> scrollpositions scrollpos[2][4]; <span class="comment">// Pour chaque écran et pour chaque fond :)</span>
00086 
00087 
00088 
00089 
00090 
00091 
00092 <span class="comment">// Mode de couleur</span>
00093 <span class="preprocessor">#define BG_COLOR16 0x00</span>
00094 <span class="preprocessor"></span><span class="preprocessor">#define BG_COLOR256 0x80</span>
00095 <span class="preprocessor"></span>
00096 
00097 <span class="preprocessor">#define CHAR_SHIFT 2</span>
00098 <span class="preprocessor"></span><span class="preprocessor">#define SCREEN_SHIFT 8</span>
00099 <span class="preprocessor"></span><span class="preprocessor">#define WRAPAROUND 0x1</span>
00100 <span class="preprocessor"></span>
00101 <span class="preprocessor">#define SCREEN_TILES 24576  // Taille à convertir pour avoir un écran complet...</span>
00102 <span class="preprocessor"></span>
00103 
00104 <span class="comment">//scrolling registers for background 0</span>
00105 
00106 
00107 <span class="comment">// Registre pour les controles de chaque écran</span>
00108 
00109 <span class="preprocessor">#define REG_BGSCREEN0  0x04000000</span>
00110 <span class="preprocessor"></span><span class="preprocessor">#define REG_BGSCREEN1  0x04001000</span>
00111 <span class="preprocessor"></span><span class="preprocessor">#define REG_BGSCREEN(screen) (0x04000000 + (screen * 0x1000))</span>
00112 <span class="preprocessor"></span>
00113 <span class="preprocessor">#define REG_BGCNT(screen, bg_number) (0x4000008 + (screen * 0x1000) + (bg_number &lt;&lt; 1))</span>
00114 <span class="preprocessor"></span>
00115 <span class="comment">// Premier registre pour les scroll. On en déduit les autres en ajoutant pour le screen et le numéro du Bg</span>
00116 <span class="preprocessor">#define REG_BGSCROLLX 0x4000010</span>
00117 <span class="preprocessor"></span><span class="preprocessor">#define REG_BGSCROLLY 0x4000012</span>
00118 <span class="preprocessor"></span>
00119 
00120 <span class="comment">// Tailles pour les Bg :</span>
00121 <span class="preprocessor">#define BG_256X256 0</span>
00122 <span class="preprocessor"></span><span class="preprocessor">#define BG_512X256 1</span>
00123 <span class="preprocessor"></span><span class="preprocessor">#define BG_256X512 2</span>
00124 <span class="preprocessor"></span><span class="preprocessor">#define BG_512X512 3</span>
00125 <span class="preprocessor"></span>
00126 <span class="preprocessor">#define BG_ROT_128X128 0</span>
00127 <span class="preprocessor"></span><span class="preprocessor">#define BG_ROT_256X256 1</span>
00128 <span class="preprocessor"></span><span class="preprocessor">#define BG_ROT_512X512 2</span>
00129 <span class="preprocessor"></span><span class="preprocessor">#define BG_ROT_1024X1024 3</span>
00130 <span class="preprocessor"></span>
00131 <span class="keywordtype">void</span> PA_LoadRotBgMap(u8 screen, u8 bg_select, <span class="keywordtype">void</span>* bg_map, u8 bg_size);
00132 
00133 
00134 <span class="comment">//ALL_BUT() pour faire tout sauf...</span>
00135 <span class="preprocessor">#define TILE_N 1023</span>
00136 <span class="preprocessor"></span><span class="preprocessor">#define TILE_PAL 61440</span>
00137 <span class="preprocessor"></span><span class="preprocessor">#define TILE_HFLIP 1024</span>
00138 <span class="preprocessor"></span><span class="preprocessor">#define TILE_VFLIP 2048</span>
00139 <span class="preprocessor"></span>
00140 <span class="preprocessor">#define PA_BGXX(screen, bg) _REG32(0x4000008 + (0x1000 * screen) + (bg &lt;&lt; 4))</span>
00141 <span class="preprocessor"></span><span class="preprocessor">#define PA_BGXY(screen, bg) _REG32(0x400000C + (0x1000 * screen) + (bg &lt;&lt; 4))</span>
00142 <span class="preprocessor"></span><span class="preprocessor">#define PA_BGXPA(screen, bg) _REG16(0x4000000 + (0x1000 * screen) + (bg &lt;&lt; 4))</span>
00143 <span class="preprocessor"></span><span class="preprocessor">#define PA_BGXPB(screen, bg) _REG16(0x4000002 + (0x1000 * screen) + (bg &lt;&lt; 4))</span>
00144 <span class="preprocessor"></span><span class="preprocessor">#define PA_BGXPC(screen, bg) _REG16(0x4000004 + (0x1000 * screen) + (bg &lt;&lt; 4))</span>
00145 <span class="preprocessor"></span><span class="preprocessor">#define PA_BGXPD(screen, bg) _REG16(0x4000006 + (0x1000 * screen) + (bg &lt;&lt; 4))</span>
00146 <span class="preprocessor"></span>
00147 
00148 
00149 
00150 
00162 <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga0">PA_ResetBgSys</a>(<span class="keywordtype">void</span>);
00163 
00186 <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga1">PA_InitBg</a>(u8 screen, u8 bg_select, u8 bg_size, u8 wraparound, u8 color_mode);
00187 <span class="comment">//#define PA_InitBg(screen, bg_select, bg_size, wraparound, color_mode) {    PA_bgmap[screen][bg_select] = ScreenBaseBlock(screen, ((bg_select + 1) &lt;&lt; 3) - bg_place[bg_size]);_REG16(REG_BGSCREEN(screen)) |= (0x100 &lt;&lt; (bg_select)); _REG16(REG_BGCNT(screen, bg_select)) = ((bg_select) | (bg_size &lt;&lt; 14) |((((bg_select + 1) &lt;&lt; 3) - bg_place[bg_size]) &lt;&lt; SCREEN_SHIFT) | (wraparound &lt;&lt; 13) | ((bg_select) &lt;&lt; 2)) + (color_mode &lt;&lt; 7);}</span>
00188 
00189 
<a name="l00202"></a><a class="code" href="group___tile.html#ga27">00202</a> <span class="preprocessor">#define PA_HideBg(screen, bg_select) _REG16(REG_BGSCREEN(screen)) &amp;= ~(0x100 &lt;&lt; (bg_select))</span>
00203 <span class="preprocessor"></span>
00204 
<a name="l00217"></a><a class="code" href="group___tile.html#ga28">00217</a> <span class="preprocessor">#define PA_ShowBg(screen, bg_select) _REG16(REG_BGSCREEN(screen)) |= (0x100 &lt;&lt; (bg_select))</span>
00218 <span class="preprocessor"></span>
00219 
<a name="l00229"></a><a class="code" href="group___tile.html#ga29">00229</a> <span class="preprocessor">#define PA_ResetBg(screen) _REG16(REG_BGSCREEN(screen)) &amp;= ~(0xF00)</span>
00230 <span class="preprocessor"></span>
00231 
00232 
<a name="l00248"></a><a class="code" href="group___tile.html#ga30">00248</a> <span class="preprocessor">#define PA_LoadBgTiles(screen, bg_select, bg_tiles) PA_LoadBgTilesEx(screen, bg_select, (void*)bg_tiles, SIZEOF_16BIT(bg_tiles))</span>
00249 <span class="preprocessor"></span><span class="comment">//#define PA_LoadBgTiles(screen, bg_select, bg_tiles) {DMA_Copy((void*)(bg_tiles), (void*)CharBaseBlock(screen, bg_select),SIZEOF_16BIT(bg_tiles), DMA_16NOW);}</span>
00250 
00251 
00271 <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga2">PA_LoadBgTilesEx</a>(u8 screen, u8 bg_select, <span class="keywordtype">void</span>* bg_tiles, u16 size);
00272 
00273 
00289 <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga3">PA_ReLoadBgTiles</a>(u8 screen, u8 bg_select, <span class="keywordtype">void</span>* bg_tiles);
00290 
00291 
00304 <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga4">PA_DeleteTiles</a>(u8 screen, u8 bg_select);
00305 
00306 
00319 <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga5">PA_DeleteMap</a>(u8 screen, u8 bg_select);
00320 
00321 
00322 
<a name="l00335"></a><a class="code" href="group___tile.html#ga6">00335</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga6">PA_DeleteBg</a>(u8 screen, u8 bg_select) {
00336        <a class="code" href="group___tile.html#ga27">PA_HideBg</a>(screen, bg_select);
00337        <a class="code" href="group___tile.html#ga4">PA_DeleteTiles</a>(screen, bg_select);
00338        <a class="code" href="group___tile.html#ga5">PA_DeleteMap</a>(screen, bg_select);
00339 }
00340 
00360 <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga7">PA_LoadBgMap</a>(u8 screen, u8 bg_select, <span class="keywordtype">void</span>* bg_map, u8 bg_size);
00361 
00362 
00363 
00364 
00365 
<a name="l00382"></a><a class="code" href="group___tile.html#ga31">00382</a> <span class="preprocessor">#define PA_LoadTiledBg(screen, bg_number, bg_name){\</span>
00383 <span class="preprocessor">       PA_LoadBgPal(screen, bg_number, (void*)bg_name##_Pal); \</span>
00384 <span class="preprocessor">       PA_LoadSimpleBg(screen, bg_number, bg_name##_Tiles, bg_name##_Map, PA_GetPAGfxBgSize(bg_name##_Width, bg_name##_Height), 0, 1);}</span>
00385 <span class="preprocessor"></span>
00386 
00387 
00388 
<a name="l00417"></a><a class="code" href="group___tile.html#ga32">00417</a> <span class="preprocessor">#define PA_LoadSimpleBg(screen, bg_select, bg_tiles, bg_map, bg_size, wraparound, color_mode) {\</span>
00418 <span class="preprocessor">PA_DeleteBg(screen, bg_select);\</span>
00419 <span class="preprocessor">PA_LoadBgTiles(screen, bg_select, bg_tiles); \</span>
00420 <span class="preprocessor">PA_LoadBgMap(screen, bg_select, (void*)bg_map, bg_size); \</span>
00421 <span class="preprocessor">PA_InitBg(screen, bg_select, bg_size, 0, color_mode);\</span>
00422 <span class="preprocessor">PA_BGScrollXY(screen, bg_select, 0, 0);}</span>
00423 <span class="preprocessor"></span>
00424 
00425 
<a name="l00450"></a><a class="code" href="group___tile.html#ga33">00450</a> <span class="preprocessor">#define PA_LoadRotBg(screen, bg_select, bg_tiles, bg_map, bg_size, wraparound) {\</span>
00451 <span class="preprocessor">PA_DeleteBg(screen, bg_select);\</span>
00452 <span class="preprocessor">PA_LoadBgTiles(screen, bg_select, bg_tiles); \</span>
00453 <span class="preprocessor">PA_LoadRotBgMap(screen, bg_select, (void*)bg_map, bg_size); \</span>
00454 <span class="preprocessor">PA_InitBg(screen, bg_select, bg_size, wraparound, 1);\</span>
00455 <span class="preprocessor">PA_SetBgRot(screen, bg_select, 0, 0, 0, 0, 0, 256);\</span>
00456 <span class="preprocessor">}</span>
00457 <span class="preprocessor"></span>
00458 <span class="keywordtype">void</span> PA_SetBgRot(u8 screen, u8 bg_select, s32 x_scroll, s32 y_scroll, s32 x_rotcentre, s32 y_rotcentre, s16 bg_angle, s32 bg_zoom);
00459 
<a name="l00491"></a><a class="code" href="group___tile.html#ga34">00491</a> <span class="preprocessor">#define PA_LoadBg(screen, bg_select, bg_tiles, tile_size, bg_map, bg_size, wraparound, color_mode) {\</span>
00492 <span class="preprocessor">PA_LoadBgTilesEx(screen, bg_select, (void*)bg_tiles, tile_size); \</span>
00493 <span class="preprocessor">PA_LoadBgMap(screen, bg_select, (void*)bg_map, bg_size); \</span>
00494 <span class="preprocessor">PA_InitBg(screen, bg_select, bg_size, 0, color_mode);\</span>
00495 <span class="preprocessor">PA_BGScrollXY(screen, bg_select, 0, 0);}</span>
00496 <span class="preprocessor"></span>
00497 
00498 
<a name="l00514"></a><a class="code" href="group___tile.html#ga35">00514</a> <span class="preprocessor">#define PA_BGScrollX(screen, bg_number, x) _REG16(REG_BGSCROLLX + ((screen) * 0x1000) + ((bg_number) &lt;&lt; 2)) = (x)&amp;1023</span>
00515 <span class="preprocessor"></span>
<a name="l00531"></a><a class="code" href="group___tile.html#ga36">00531</a> <span class="preprocessor">#define PA_BGScrollY(screen, bg_number, y) _REG16(REG_BGSCROLLY + ((screen) * 0x1000) + ((bg_number) &lt;&lt; 2)) = (y)&amp;1023</span>
00532 <span class="preprocessor"></span>
00533 
00534 
00535 
<a name="l00554"></a><a class="code" href="group___tile.html#ga37">00554</a> <span class="preprocessor">#define PA_BGScrollXY(screen, bg_number, x, y) {PA_BGScrollX(screen, bg_number, x); PA_BGScrollY(screen, bg_number, y);}</span>
00555 <span class="preprocessor"></span>
00556 
00557 
00558 
<a name="l00580"></a><a class="code" href="group___tile.html#ga9">00580</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga9">PA_SetMapTile</a>(u8 screen, u8 bg_select, s16 x, s16 y, s16 tile_number) {
00581 *(u16*)(PA_bgmap[screen][bg_select] + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) &amp;= ~(TILE_N); 
00582 *(u16*)(PA_bgmap[screen][bg_select] + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) |= ((tile_number)&amp;TILE_N);
00583 }
00584 
00585 
<a name="l00607"></a><a class="code" href="group___tile.html#ga10">00607</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga10">PA_SetMapTileAll</a>(u8 screen, u8 bg_select, s16 x, s16 y, u16 tile_info){
00608        *(u16*)(PA_bgmap[screen][bg_select] + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) = tile_info;
00609 }
00610 
00611 
00612 
00613 
<a name="l00635"></a><a class="code" href="group___tile.html#ga11">00635</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga11">PA_SetLargeMapTile</a>(u8 screen, u8 bg_select, s32 x, s32 y, u32 tile_info) {
00636        u32 truex;
00637        u32 mapblock = 0;
00638        truex = x&amp;31;
00639        mapblock = (x &gt;&gt; 5) &lt;&lt; 11; <span class="comment">// Permet d'avoir le bon block...</span>
00640        
00641        *(u16*)(PA_bgmap[screen][bg_select] + ((truex) &lt;&lt; 1) + ((y) &lt;&lt; 6) + mapblock) = tile_info;
00642 }
00643 
00644 
00645 
<a name="l00667"></a><a class="code" href="group___tile.html#ga38">00667</a> <span class="preprocessor">#define PA_SetMapTileHflip(screen, bg_select, x, y, hflip) {*(u16*)(PA_bgmap[screen][bg_select] + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) &amp;= ALL_BUT(TILE_HFLIP); *(u16*)(PA_bgmap[screen][bg_select] + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) |= ((hflip) &lt;&lt; 10);}</span>
00668 <span class="preprocessor"></span>
00669 
<a name="l00691"></a><a class="code" href="group___tile.html#ga39">00691</a> <span class="preprocessor">#define PA_SetMapTileVflip(screen, bg_select, x, y, vflip) {*(u16*)(PA_bgmap[screen][bg_select] + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) &amp;= ALL_BUT(TILE_VFLIP); *(u16*)(PA_bgmap[screen][bg_select] + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) |= ((vflip) &lt;&lt; 11);}</span>
00692 <span class="preprocessor"></span>
00693 
<a name="l00715"></a><a class="code" href="group___tile.html#ga40">00715</a> <span class="preprocessor">#define PA_SetMapTilePal(screen, bg_select, x, y, palette_number) {*(u16*)(PA_bgmap[screen][bg_select] + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) &amp;= ALL_BUT(TILE_PAL); *(u16*)(PA_bgmap[screen][bg_select] + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) |= ((palette_number) &lt;&lt; 12);}</span>
00716 <span class="preprocessor"></span>
00717 
00748 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> PA_SetMapTileEx(u8 screen, u8 bg_select, s16 x, s16 y, u16 tile_number, u8 hflip, u8 vflip, u8 palette_number) {
00749        *(u16*)(PA_bgmap[screen][bg_select] + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) = (tile_number) + ((hflip) &lt;&lt; 10) + ((vflip) &lt;&lt; 11) + ((palette_number) &lt;&lt; 12);
00750 }
00751 
00752 
00753 
<a name="l00766"></a><a class="code" href="group___tile.html#ga41">00766</a> <span class="preprocessor">#define PA_LoadTiledBitmap(screen, tiled_bitmap) PA_LoadBg(screen, 0, tiled_bitmap, SCREEN_TILES, bitmap, BG_256X256, 1, 1)</span>
00767 <span class="preprocessor"></span>
00768 
00769 
<a name="l00788"></a><a class="code" href="group___tile.html#ga42">00788</a> <span class="preprocessor">#define PA_LoadPAGfxRotBg(screen, bg_select, bg_name, wraparound) {\</span>
00789 <span class="preprocessor">PA_LoadNormalBgPal(screen, (void*)bg_name##_Pal);\</span>
00790 <span class="preprocessor">PA_LoadRotBg(screen, bg_select, bg_name##_Tiles, bg_name##_Map, PA_GetPAGfxRotBgSize(bg_name##_Width), wraparound);\</span>
00791 <span class="preprocessor">}</span>
00792 <span class="preprocessor"></span>
00793 
00794 
00795 
00796 
<a name="l00824"></a><a class="code" href="group___tile.html#ga43">00824</a> <span class="preprocessor">#define PA_LoadLargeBg(screen, bg_select, bg_tiles, bg_map, color_mode, lx, ly) {\</span>
00825 <span class="preprocessor">PA_LoadSimpleBg(screen, bg_select, bg_tiles, Blank, BG_512X256, 0, color_mode);\</span>
00826 <span class="preprocessor">PA_InitLargeBg(screen, bg_select, lx, ly, (void*)bg_map);}</span>
00827 <span class="preprocessor"></span>
00828 
00829 
00830 
<a name="l00846"></a><a class="code" href="group___tile.html#ga44">00846</a> <span class="preprocessor">#define PA_LoadPAGfxLargeBg(screen, bg_number, bg_name){\</span>
00847 <span class="preprocessor">       PA_LoadBgPal(screen, bg_number, (void*)bg_name##_Pal); \</span>
00848 <span class="preprocessor">       PA_LoadLargeBg(screen, bg_number, bg_name##_Tiles, bg_name##_Map, 1, (bg_name##_Width) &gt;&gt; 3, (bg_name##_Height) &gt;&gt; 3);}</span>
00849 <span class="preprocessor"></span>
00850 
00851 
<a name="l00882"></a><a class="code" href="group___tile.html#ga45">00882</a> <span class="preprocessor">#define PA_LoadLargeBgEx(screen, bg_select, bg_tiles, tile_size, bg_map, color_mode, lx, ly) {\</span>
00883 <span class="preprocessor">PA_LoadBg(screen, bg_select, bg_tiles, tile_size, Blank, BG_512X256, 0, color_mode);\</span>
00884 <span class="preprocessor">PA_InitLargeBg(screen, bg_select, lx, ly, (void*)bg_map);}</span>
00885 <span class="preprocessor"></span>
00886 
00887 
00888 
00904 <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga13">PA_InfLargeScrollX</a>(u8 screen, u8 bg_select, s32 x);
00905 
00906 
00922 <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga14">PA_InfLargeScrollY</a>(u8 screen, u8 bg_select, s32 y);
00923 
00924 
00925 
<a name="l00944"></a><a class="code" href="group___tile.html#ga15">00944</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga15">PA_InfLargeScrollXY</a>(u8 screen, u8 bg_select, s32 x, s32 y){
00945        <a class="code" href="group___tile.html#ga13">PA_InfLargeScrollX</a>(screen, bg_select, x);
00946        <a class="code" href="group___tile.html#ga14">PA_InfLargeScrollY</a>(screen, bg_select, y);
00947 }
00948 
00964 <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga16">PA_LargeScrollX</a>(u8 screen, u8 bg_select, s32 x);
00965 
00966 
00982 <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga17">PA_LargeScrollY</a>(u8 screen, u8 bg_select, s32 y);
00983 
00984 
00985 
<a name="l01004"></a><a class="code" href="group___tile.html#ga18">01004</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga18">PA_LargeScrollXY</a>(u8 screen, u8 bg_select, s32 x, s32 y){
01005        <a class="code" href="group___tile.html#ga16">PA_LargeScrollX</a>(screen, bg_select, x);
01006        <a class="code" href="group___tile.html#ga17">PA_LargeScrollY</a>(screen, bg_select, y);
01007 }
01008 
01009 
01010 
<a name="l01032"></a><a class="code" href="group___tile.html#ga19">01032</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga19">PA_InitParallaxX</a>(u8 screen, s32 bg0, s32 bg1, s32 bg2, s32 bg3) {
01033         PA_parallaxX[screen][0] = bg0;
01034         PA_parallaxX[screen][1] = bg1;
01035         PA_parallaxX[screen][2] = bg2;
01036         PA_parallaxX[screen][3] = bg3;
01037 }
01038 
<a name="l01060"></a><a class="code" href="group___tile.html#ga20">01060</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga20">PA_InitParallaxY</a>(u8 screen, s32 bg0, s32 bg1, s32 bg2, s32 bg3) {
01061         PA_parallaxY[screen][0] = bg0;
01062         PA_parallaxY[screen][1] = bg1;
01063         PA_parallaxY[screen][2] = bg2;
01064         PA_parallaxY[screen][3] = bg3;
01065 }
01066 
01067 
01068 
<a name="l01081"></a><a class="code" href="group___tile.html#ga21">01081</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga21">PA_ParallaxScrollX</a>(u8 screen, s32 x){
01082 u8 i;
01083        <span class="keywordflow">for</span>(i = 0; i &lt; 4; i++) {
01084               <span class="keywordflow">if</span> (PA_parallaxX[screen][i])  {
01085                      <span class="keywordflow">if</span>(scrollpos[screen][i].infscroll) <a class="code" href="group___tile.html#ga13">PA_InfLargeScrollX</a>(screen, i, (PA_parallaxX[screen][i] * x) &gt;&gt; 8); <span class="comment">// Si bg en scrolling infini</span>
01086                      <span class="keywordflow">else</span> <a class="code" href="group___tile.html#ga35">PA_BGScrollX</a>(screen, i, (PA_parallaxX[screen][i] * x) &gt;&gt; 8); <span class="comment">// Sinon scrolling normal</span>
01087               }
01088        }
01089 }
01090 
01091 
<a name="l01104"></a><a class="code" href="group___tile.html#ga22">01104</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga22">PA_ParallaxScrollY</a>(u8 screen, s32 y){
01105 u8 i;
01106        <span class="keywordflow">for</span>(i = 0; i &lt; 4; i++) {
01107               <span class="keywordflow">if</span> (PA_parallaxY[screen][i])  {
01108                      <span class="keywordflow">if</span>(scrollpos[screen][i].infscroll) <a class="code" href="group___tile.html#ga14">PA_InfLargeScrollY</a>(screen, i, (PA_parallaxY[screen][i] * y) &gt;&gt; 8); <span class="comment">// Si bg en scrolling infini</span>
01109                      <span class="keywordflow">else</span> <a class="code" href="group___tile.html#ga36">PA_BGScrollY</a>(screen, i, (PA_parallaxY[screen][i] * y) &gt;&gt; 8); <span class="comment">// Sinon scrolling normal</span>
01110               }
01111        }
01112 }
01113 
01114 
<a name="l01130"></a><a class="code" href="group___tile.html#ga23">01130</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga23">PA_ParallaxScrollXY</a>(u8 screen, s32 x, s32 y){
01131        <a class="code" href="group___tile.html#ga21">PA_ParallaxScrollX</a>(screen, x);
01132        <a class="code" href="group___tile.html#ga22">PA_ParallaxScrollY</a>(screen, y);
01133 }
01134 
01135 
01136 
<a name="l01152"></a><a class="code" href="group___tile.html#ga24">01152</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga24">PA_SetBgPrio</a>(u8 screen, u8 bg, u8 prio) {
01153        _REG16(REG_BGCNT(screen, bg)) &amp;= ~3;
01154        _REG16(REG_BGCNT(screen, bg)) |= prio;
01155 }
01156 
01157 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> PA_CreateBgFromTiles(u8 screen, u8 bg_select, u8 bg_tiles, <span class="keywordtype">void</span> *bg_map, u8 bg_size){
01158 <a class="code" href="group___tile.html#ga7">PA_LoadBgMap</a>(screen, bg_select, bg_map, bg_size);
01159 scrollpos[screen][bg_select].infscroll = 0; <span class="comment">// Par défaut pas de scrolling infini...</span>
01160 PA_bgmap[screen][bg_select] = ScreenBaseBlock(screen, mapchar[screen][bg_select]);
01161 tilesetchar[screen][bg_select] = tilesetchar[screen][bg_tiles];
01162 tilesetsize[screen][bg_select] = tilesetsize[screen][bg_tiles];
01163 
01164 _REG16(REG_BGSCREEN(screen)) |= (0x100 &lt;&lt; (bg_select));
01165 _REG16(REG_BGCNT(screen, bg_select)) = bg_select | (bg_size &lt;&lt; 14) |(mapchar[screen][bg_select] &lt;&lt; SCREEN_SHIFT) | (1 &lt;&lt; 13) | (tilesetchar[screen][bg_select] &lt;&lt; 2) | (1 &lt;&lt; 7);
01166 <a class="code" href="group___tile.html#ga37">PA_BGScrollXY</a>(screen, bg_select, 0, 0);   
01167 }
01168 
01169 
<a name="l01181"></a><a class="code" href="group___tile.html#ga26">01181</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___tile.html#ga26">PA_ClearBg</a>(u8 screen, u8 bg_select){
01182 u8 i, j;
01183 <span class="keywordflow">for</span> (i = 0; i &lt; 32; i++) <span class="keywordflow">for</span> (j = 0; j &lt; 32; j++) <a class="code" href="group___tile.html#ga10">PA_SetMapTileAll</a>(screen, bg_select, i, j, 0);
01184 }
01185 
01186  <span class="comment">// end of Backgrounds</span>
01188 
01189 
01190 
01191 <span class="comment">// Pas utilisé en direct par le programmaeur</span>
01192 <span class="keywordtype">void</span> PA_InitLargeBg(u8 screen, u8 bg_select, s32 lx, s32 ly, <span class="keywordtype">void</span>* bg_map);
01193 
01194 
01195 
01196 <span class="preprocessor">#endif</span>
01197 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sat Mar 4 12:16:44 2006 for PAlib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
