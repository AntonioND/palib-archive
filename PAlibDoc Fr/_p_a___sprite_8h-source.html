<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PAlib:  Fichier source de PA_Sprite.h</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Généré par Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Page&nbsp;principale</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">Liste&nbsp;des&nbsp;fichiers</a> | <a class="qindex" href="globals.html">Portée&nbsp;globale</a>  | <span class="search">Rechercher&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>PA_Sprite.h</h1><a href="_p_a___sprite_8h.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef _PA_Sprite</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define _PA_Sprite</span>
00003 <span class="preprocessor"></span>
00004 <span class="preprocessor">#ifdef __cplusplus</span>
00005 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00006 <span class="preprocessor">#endif</span>
00007 <span class="preprocessor"></span>
00014 <span class="preprocessor">#include "PA_Math.h"</span>
00015 
00016 
00017 <span class="preprocessor">#define EWRAM_DATA   __attribute__((section(".ewram")))</span>
00018 <span class="preprocessor"></span><span class="preprocessor">#define EWRAM_BSS    __attribute__((section(".sbss")))</span>
00019 <span class="preprocessor"></span><span class="preprocessor">#define PA_Cos(angle) PA_SIN[((angle) + 128)&amp;511]</span>
00020 <span class="preprocessor"></span><span class="preprocessor">#define PA_Sin(angle) PA_SIN[((angle))&amp;511]</span>
00021 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keyword">const</span> s16 PA_SIN[512]; 
00022 
00023 <span class="preprocessor">#define MAX_DRAW 16  // Maximum 16 sprites dessinables...</span>
00024 <span class="preprocessor"></span>
00025 
00027 <span class="comment">// Système de sprites</span>
00029 <span class="comment"></span>
00030 
00031 <span class="preprocessor">#define OBJ_SIZE_8X8      0,0</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_16X16    0,1</span>
00033 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_32X32    0,2</span>
00034 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_64X64    0,3</span>
00035 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_16X8     1,0</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_32X8     1,1</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_32X16    1,2</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_64X32    1,3</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_8X16     2,0</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_8X32     2,1</span>
00041 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_16X32    2,2</span>
00042 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_32X64    2,3</span>
00043 <span class="preprocessor"></span>
00044 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00045        u8 lx, ly;
00046 } PA_sizes;
00047 
00048 <span class="keyword">extern</span> <span class="keyword">const</span> PA_sizes PA_size[3][4];
00049 
00050 
00051 <span class="preprocessor">#define BITS_16 65535</span>
00052 <span class="preprocessor"></span><span class="preprocessor">#define ALL_BUT(ATR) (BITS_16 - ATR)</span>
00053 <span class="preprocessor"></span>
00054 <span class="preprocessor">#define PA_OBJ_X 511 //511, debugging...</span>
00055 <span class="preprocessor"></span><span class="preprocessor">#define PA_OBJ_Y 255</span>
00056 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_ROT 256</span>
00057 <span class="preprocessor"></span><span class="preprocessor">#define ALL_BUT_ROTSET 49663  // Numéro du rotset</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#define ALL_BUT_PAL 4095</span>
00059 <span class="preprocessor"></span>
00060 <span class="preprocessor">#define DBLSIZE 512</span>
00061 <span class="preprocessor"></span><span class="preprocessor">#define N_COLORS (1 &lt;&lt; 13)</span>
00062 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_MODE 3072</span>
00063 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_MOSAIC 4096</span>
00064 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_HFLIP 4096</span>
00065 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_VFLIP 8192</span>
00066 <span class="preprocessor"></span>
00067 <span class="preprocessor">#define OBJ_GFX 1023</span>
00068 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_PRIO 3072</span>
00069 <span class="preprocessor"></span>
00070 <span class="preprocessor">#define COLORS_256 1</span>
00071 <span class="preprocessor"></span><span class="preprocessor">#define COLORS_16 0</span>
00072 <span class="preprocessor"></span>
00073 
00074 
00075 <span class="preprocessor">#define MEM_DECAL 5</span>
00076 <span class="preprocessor"></span><span class="preprocessor">#define NUMBER_DECAL 7</span>
00077 <span class="preprocessor"></span>
00078 
00079 
00080 <span class="comment">// Mémoire gfx</span>
00081 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00082    u16 mem_block;  <span class="comment">// Emplacement en mémoire, de 0 à 1023</span>
00083    u16 free; <span class="comment">// Doonées libres en ce point</span>
00084 } mem_usage;
00085 
00086 <span class="keyword">extern</span> u16 n_free_mem[2]; <span class="comment">// nombre d'emplacements libres</span>
00087 <span class="keyword">extern</span> u8 used_mem[2][1024]; <span class="comment">// Note la quantité de mémoire utilisée en chaque point de la mémoire pour pouvoir effacer les gfx...</span>
00088 <span class="keyword">extern</span> u8 obj_per_gfx[2][1024]; <span class="comment">// Nombre de sprites utilisant un gfx donné...</span>
00089 <span class="keyword">extern</span> mem_usage free_mem[2][1024];
00090 
00091 <span class="keyword">extern</span> u16 FirstGfx[2];
00092 
00093 <span class="keyword">extern</span> <span class="keyword">const</span> u16 PA_obj_sizes[4][3];
00094 
00095 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00096    u16 atr0, atr1, atr2, atr3;
00097 }obj_inf;
00098 <span class="keyword">extern</span> obj_inf PA_obj[2][128];  <span class="comment">// Les 128 premiers pour l'écran du haut, et encore 128 pour l'écran du bas...</span>
00099 
00100 <span class="keyword">extern</span> u8 PA_SpritePrio[2][128]; <span class="comment">// Set the sprite priorities...</span>
00101 
00102 <span class="comment">// Infos pour dessiner sur les sprites</span>
00103 <span class="comment">/*</span>
00104 <span class="comment">typedef struct {</span>
00105 <span class="comment">       u8 screen; // Ecran</span>
00106 <span class="comment">       u8 sprite;           // Numéro du sprite</span>
00107 <span class="comment">       u8 wasdrawing; // Si on dessinait dessus ou pas avant</span>
00108 <span class="comment">       s8 x, y;  // Position x et y d'avant</span>
00109 <span class="comment">       u8 hsize, vsize; // Tailles</span>
00110 <span class="comment">       u8 n_colors; // Nombre de couleurs</span>
00111 <span class="comment">       u8 drawsize;</span>
00112 <span class="comment">       u32 *gfxpointer; // Pour dessiner à l'écran directement</span>
00113 <span class="comment">} PA_DrawSprites;</span>
00114 <span class="comment">*/</span>
00115 
00116 
00117 <span class="comment">//extern PA_DrawSprites PA_DrawSprite[MAX_DRAW];</span>
00118 
00119 <span class="comment">// Pour le dessin sur sprite</span>
00120 <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *PA_SpriteBuffer[MAX_DRAW]; <span class="comment">// Pointeurs vers les buffers  que l'on créera à la volée</span>
00121 
00122 <span class="keyword">extern</span> u16 *PA_SpriteAnimP[2][1024];
00123 
00124 
00125 <span class="preprocessor">#define ANIM_LOOP 0 // loop around</span>
00126 <span class="preprocessor"></span><span class="preprocessor">#define ANIM_UPDOWN 1 // back and forth animation</span>
00127 <span class="preprocessor"></span>
00128 <span class="preprocessor">#define ANIM_ONESHOT ANIM_LOOP, 1</span>
00129 <span class="preprocessor"></span><span class="preprocessor">#define ANIM_INFINITE ANIM_LOOP, -1</span>
00130 <span class="preprocessor"></span>
00131 
00132 
00133 <span class="keyword">extern</span> s16 nspriteanims; <span class="comment">// Number of animated sprites currently...</span>
00134 <span class="keyword">typedef</span> <span class="keyword">struct</span>{
00135        s32 firstframe, lastframe, currentframe; <span class="comment">// frames...</span>
00136        s8 framechange; <span class="comment">// 1 by default, -1 to go back...</span>
00137        s32 time; <span class="comment">// Time...</span>
00138        u8 lx, ly; <span class="comment">// Sprite sizes</span>
00139        u8 colors; 
00140        s16 speed;
00141        u8 play;
00142        u16 *gfx; <span class="comment">// gfx pointer</span>
00143        u8 type;
00144        s32 ncycles;
00145        u32 HideX;
00146 <span class="comment">//     bool exists; //</span>
00147 } spriteanim;
00148 <span class="keyword">extern</span> spriteanim spriteanims[2][128]; <span class="comment">// Init the array on PAlib init...</span>
00149 
00150 <span class="comment">//#define spriteanimsize 40</span>
00151 
00152 
00153 
00154 <span class="keyword">extern</span> u8 PA_SpriteExtPrio;
00155 
00156 
00157 
00158 
00159 
00160 
00161 <span class="preprocessor">#define OAM0 0x07000000</span>
00162 <span class="preprocessor"></span><span class="preprocessor">#define OAM1 0x07000400</span>
00163 <span class="preprocessor"></span>
00164 
<a name="l00177"></a><a class="code" href="group___sprite.html#ga38">00177</a> <span class="preprocessor">#define PA_UpdateOAM0() DMA_Copy((void*)PA_obj, (void*)OAM0, 256, DMA_32NOW)</span>
00178 <span class="preprocessor"></span>
<a name="l00184"></a><a class="code" href="group___sprite.html#ga39">00184</a> <span class="preprocessor">#define PA_UpdateOAM1() DMA_Copy((void*)PA_obj + 256, (void*)OAM1, 256, DMA_32NOW)</span>
00185 <span class="preprocessor"></span>
00186 
00187 
00188 
00189 
00190 
00197 <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga0">PA_UpdateOAM</a>(<span class="keywordtype">void</span>);
00198 
00199 
00221 u16 <a class="code" href="group___sprite.html#ga1">PA_CreateGfx</a>(u8 screen, <span class="keywordtype">void</span>* obj_data, u8 obj_shape, u8 obj_size, u8 color_mode);
00222 
00231 <span class="keywordtype">void</span> PA_ResetSpriteSysScreen(u8 screen);
00232 
00233 
00239 <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga3">PA_ResetSpriteSys</a>(<span class="keywordtype">void</span>);
00240 
00241 
00242 
<a name="l00275"></a><a class="code" href="group___sprite.html#ga4">00275</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga4">PA_CreateSprite</a>(u8 screen, u8 obj_number, <span class="keywordtype">void</span>* obj_data, u8 obj_shape, u8 obj_size, u8 color_mode, u8 palette, s16 x, s16 y) {
00276    PA_obj[screen][obj_number].atr2 = <a class="code" href="group___sprite.html#ga1">PA_CreateGfx</a>(screen, obj_data, obj_shape, obj_size, color_mode) + (palette &lt;&lt; 12);
00277    PA_obj[screen][obj_number].atr0 = (y&amp;PA_OBJ_Y) + (color_mode &lt;&lt; 13) + (obj_shape &lt;&lt; 14);
00278    PA_obj[screen][obj_number].atr1 = (x &amp; PA_OBJ_X) + (obj_size &lt;&lt; 14);
00279 };
00280 
<a name="l00331"></a><a class="code" href="group___sprite.html#ga5">00331</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga5">PA_CreateSpriteEx</a>(u8 screen, u8 obj_number, <span class="keywordtype">void</span>* obj_data, u8 obj_shape, u8 obj_size, u8 color_mode, u8 palette, u8 obj_mode, u8 mosaic, u8 hflip, u8 vflip, u8 prio, u8 dblsize, s16 x, s16 y) {
00332    PA_obj[screen][obj_number].atr2 = <a class="code" href="group___sprite.html#ga1">PA_CreateGfx</a>(screen, obj_data, obj_shape, obj_size, color_mode) + (prio &lt;&lt; 10) + (palette &lt;&lt; 12);
00333    PA_obj[screen][obj_number].atr0 = (y&amp;PA_OBJ_Y) + (dblsize &lt;&lt; 9) + (obj_mode &lt;&lt; 10) + (mosaic &lt;&lt; 12) + ((color_mode) &lt;&lt; 13) + (obj_shape &lt;&lt; 14);
00334    PA_obj[screen][obj_number].atr1 = (x &amp; PA_OBJ_X) + (hflip &lt;&lt; 12) + (vflip &lt;&lt; 13) + (obj_size &lt;&lt; 14);
00335 };
00336 
00337 
00338 
00339 
00340 
<a name="l00382"></a><a class="code" href="group___sprite.html#ga6">00382</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga6">PA_Create16bitSpriteEx</a>(u8 screen, u8 obj_number, <span class="keywordtype">void</span>* obj_data, u8 obj_shape, u8 obj_size, u8 mosaic, u8 hflip, u8 vflip, u8 prio, u8 dblsize, s16 x, s16 y){
00383    PA_obj[screen][obj_number].atr2 = <a class="code" href="group___sprite.html#ga1">PA_CreateGfx</a>(screen, obj_data, obj_shape, obj_size, 2) + (prio &lt;&lt; 10);<span class="comment">// + (15 &lt;&lt; 12);</span>
00384    PA_obj[screen][obj_number].atr0 = (y&amp;PA_OBJ_Y) + (dblsize &lt;&lt; 9) + (3 &lt;&lt; 10) + (mosaic &lt;&lt; 12) + (0 &lt;&lt; 13) + (obj_shape &lt;&lt; 14);
00385    PA_obj[screen][obj_number].atr1 = (x &amp; PA_OBJ_X) + (hflip &lt;&lt; 12) + (vflip &lt;&lt; 13) + (obj_size &lt;&lt; 14);
00386 }
00387 
00388 
00389 
00390 
<a name="l00417"></a><a class="code" href="group___sprite.html#ga7">00417</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga7">PA_Create16bitSpriteFromGfx</a>(u8 screen, u8 obj_number, u16 gfx, u8 obj_shape, u8 obj_size, s16 x, s16 y){
00418    PA_obj[screen][obj_number].atr2 = gfx + (15 &lt;&lt; 12);
00419    PA_obj[screen][obj_number].atr0 = (y&amp;PA_OBJ_Y) + (3 &lt;&lt; 10) + (obj_shape &lt;&lt; 14);
00420    PA_obj[screen][obj_number].atr1 = (x &amp; PA_OBJ_X) + (obj_size &lt;&lt; 14);
00421 }
00422 
00423 
00424 
00425 
00426 
<a name="l00453"></a><a class="code" href="group___sprite.html#ga8">00453</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga8">PA_Create16bitSprite</a>(u8 screen, u8 obj_number, <span class="keywordtype">void</span>* obj_data, u8 obj_shape, u8 obj_size, s16 x, s16 y){
00454 <a class="code" href="group___sprite.html#ga6">PA_Create16bitSpriteEx</a>(screen, obj_number, obj_data, obj_shape, obj_size, 0, 0, 0, 0, 0, x, y);
00455 }
00456 
00457 
00458 
00459 
<a name="l00492"></a><a class="code" href="group___sprite.html#ga9">00492</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga9">PA_CreateSpriteFromGfx</a>(u8 screen, u8 obj_number, u16 obj_gfx, u8 obj_shape, u8 obj_size, u8 color_mode, u8 palette, s16 x, s16 y) {
00493    PA_obj[screen][obj_number].atr2 = obj_gfx + (palette &lt;&lt; 12);
00494    PA_obj[screen][obj_number].atr0 = (y&amp;PA_OBJ_Y) + (color_mode &lt;&lt; 13) + (obj_shape &lt;&lt; 14);
00495    PA_obj[screen][obj_number].atr1 = (x &amp; PA_OBJ_X) + (obj_size &lt;&lt; 14);
00496    ++obj_per_gfx[screen][obj_gfx];
00497 };
00498 
<a name="l00549"></a><a class="code" href="group___sprite.html#ga10">00549</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga10">PA_CreateSpriteExFromGfx</a>(u8 screen, u8 obj_number, u16 obj_gfx, u8 obj_shape, u8 obj_size, u8 color_mode, u8 palette, u8 obj_mode, u8 mosaic, u8 hflip, u8 vflip, u8 prio, u8 dblsize, s16 x, s16 y) {
00550    PA_obj[screen][obj_number].atr2 = obj_gfx + (prio &lt;&lt; 10) + (palette &lt;&lt; 12);
00551    PA_obj[screen][obj_number].atr0 = (y&amp;PA_OBJ_Y) + (dblsize &lt;&lt; 9) + (obj_mode &lt;&lt; 10) + (mosaic &lt;&lt; 12) + (color_mode &lt;&lt; 13) + (obj_shape &lt;&lt; 14);
00552    PA_obj[screen][obj_number].atr1 = (x &amp; PA_OBJ_X) + (hflip &lt;&lt; 12) + (vflip &lt;&lt; 13) + (obj_size &lt;&lt; 14);
00553    ++obj_per_gfx[screen][obj_gfx];
00554 };
00555 
00556 
<a name="l00571"></a><a class="code" href="group___sprite.html#ga40">00571</a> <span class="preprocessor">#define PA_UpdateSpriteGfx(screen, obj_number, obj_data) PA_UpdateGfx(screen, PA_GetSpriteGfx(screen, obj_number), obj_data)</span>
00572 <span class="preprocessor"></span>
<a name="l00590"></a><a class="code" href="group___sprite.html#ga11">00590</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga11">PA_UpdateGfx</a>(u8 screen, u16 gfx_number, <span class="keywordtype">void</span> *obj_data) {
00591        DMA_Copy((obj_data), (<span class="keywordtype">void</span>*)(SPRITE_GFX1 + (0x200000 *  (screen)) + ((gfx_number) &lt;&lt; NUMBER_DECAL)), (used_mem[screen][gfx_number] &lt;&lt; (MEM_DECAL+1)), DMA_16NOW);
00592 <span class="comment">//     PA_OutputText(1, 25, PA_Rand()&amp;15, "%dgfx   ", gfx_number);</span>
00593 }
00594 
00595 
<a name="l00611"></a><a class="code" href="group___sprite.html#ga12">00611</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga12">PA_UpdateGfxAndMem</a>(u8 screen, u8 gfx_number, <span class="keywordtype">void</span> *obj_data){
00612        DMA_Copy((obj_data), (<span class="keywordtype">void</span>*)(SPRITE_GFX1 + (0x200000 *  (screen)) + ((gfx_number) &lt;&lt; NUMBER_DECAL)), (used_mem[screen][gfx_number] &lt;&lt; MEM_DECAL), DMA_32NOW);
00613        PA_SpriteAnimP[screen][gfx_number] = (u16*)obj_data; <span class="comment">// mémorise la source de l'image...</span>
00614 }
00615 
00616 
00617 
00618 
00630 <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga13">PA_DeleteGfx</a>(u8 screen, u16 obj_gfx);
00631 
00632 
00644 <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga14">PA_DeleteSprite</a>(u8 screen, u8 obj_number);
00645 
00646 
<a name="l00662"></a><a class="code" href="group___sprite.html#ga41">00662</a> <span class="preprocessor">#define PA_SetSpriteRotEnable(screen, sprite, rotset) {PA_obj[screen][sprite].atr0 |= OBJ_ROT;  PA_obj[screen][sprite].atr1 = (PA_obj[screen][sprite].atr1 &amp; ALL_BUT_ROTSET) + ((rotset) &lt;&lt; 9);}</span>
00663 <span class="preprocessor"></span>
<a name="l00675"></a><a class="code" href="group___sprite.html#ga42">00675</a> <span class="preprocessor">#define PA_SetSpriteRotDisable(screen, sprite) {PA_obj[screen][sprite].atr0 &amp;= ALL_BUT(OBJ_ROT);  PA_obj[screen][sprite].atr1 &amp;= ALL_BUT_ROTSET;}</span>
00676 <span class="preprocessor"></span>
00677 
<a name="l00699"></a><a class="code" href="group___sprite.html#ga15">00699</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga15">PA_SetRotset</a>(u8 screen, u8 rotset, s16 angle, u16 zoomx, u16 zoomy) {
00700 u8 obj_num = (rotset &lt;&lt; 2);
00701        PA_obj[screen][obj_num].atr3 = (<a class="code" href="group___math.html#ga10">PA_Cos</a>(angle) * zoomx) &gt;&gt; 8;
00702        PA_obj[screen][obj_num + 1].atr3 = (-<a class="code" href="group___math.html#ga11">PA_Sin</a>(angle) * zoomy) &gt;&gt; 8;
00703        PA_obj[screen][obj_num + 2].atr3 = (<a class="code" href="group___math.html#ga11">PA_Sin</a>(angle) * zoomx) &gt;&gt; 8;
00704        PA_obj[screen][obj_num + 3].atr3 = (<a class="code" href="group___math.html#ga10">PA_Cos</a>(angle) * zoomy) &gt;&gt; 8;
00705 }
00706 
<a name="l00721"></a><a class="code" href="group___sprite.html#ga16">00721</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga16">PA_SetRotsetNoZoom</a>(u8 screen, u8 rotset, s16 angle)   {
00722 u8 obj_num = (rotset &lt;&lt; 2);
00723        PA_obj[screen][obj_num].atr3 = <a class="code" href="group___math.html#ga10">PA_Cos</a>(angle);
00724        PA_obj[screen][obj_num + 1].atr3 = -<a class="code" href="group___math.html#ga11">PA_Sin</a>(angle);
00725        PA_obj[screen][obj_num + 2].atr3 = <a class="code" href="group___math.html#ga11">PA_Sin</a>(angle);
00726        PA_obj[screen][obj_num + 3].atr3 = <a class="code" href="group___math.html#ga10">PA_Cos</a>(angle);
00727 }
00728 
<a name="l00746"></a><a class="code" href="group___sprite.html#ga17">00746</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga17">PA_SetRotsetNoAngle</a>(u8 screen, u8 rotset, u16 zoomx, u16 zoomy) {
00747 u8 obj_num = (rotset &lt;&lt; 2);
00748        PA_obj[screen][obj_num].atr3 = zoomx;
00749        PA_obj[screen][obj_num + 1].atr3 = 0;
00750        PA_obj[screen][obj_num + 2].atr3 = 0;
00751        PA_obj[screen][obj_num + 3].atr3 = zoomy;
00752 }
00753 
00754 
00755 
00756 
00757 
00758 
00759 
<a name="l00776"></a><a class="code" href="group___sprite.html#ga43">00776</a> <span class="preprocessor">#define PA_SetSpriteX(screen, obj, x) PA_obj[screen][obj].atr1 = (PA_obj[screen][obj].atr1 &amp; ALL_BUT(PA_OBJ_X)) + ((x) &amp; PA_OBJ_X)</span>
00777 <span class="preprocessor"></span>
<a name="l00790"></a><a class="code" href="group___sprite.html#ga44">00790</a> <span class="preprocessor">#define PA_GetSpriteX(screen, obj) (PA_obj[screen][obj].atr1 &amp; (PA_OBJ_X))</span>
00791 <span class="preprocessor"></span>
00792 
<a name="l00807"></a><a class="code" href="group___sprite.html#ga45">00807</a> <span class="preprocessor">#define PA_SetSpriteY(screen, obj, y) PA_obj[screen][obj].atr0 = (PA_obj[screen][obj].atr0 &amp; ALL_BUT(PA_OBJ_Y)) + ((y) &amp; PA_OBJ_Y)</span>
00808 <span class="preprocessor"></span>
<a name="l00821"></a><a class="code" href="group___sprite.html#ga46">00821</a> <span class="preprocessor">#define PA_GetSpriteY(screen, obj) (PA_obj[screen][obj].atr0 &amp; PA_OBJ_Y)</span>
00822 <span class="preprocessor"></span>
00823 
00824 
<a name="l00842"></a><a class="code" href="group___sprite.html#ga18">00842</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga18">PA_SetSpriteXY</a>(u8 screen, u8 sprite, s16 x, s16 y) {
00843        <a class="code" href="group___sprite.html#ga43">PA_SetSpriteX</a>(screen, sprite, x); 
00844        <a class="code" href="group___sprite.html#ga45">PA_SetSpriteY</a>(screen, sprite, y);
00845 }
00846 
00847 
00848 
<a name="l00863"></a><a class="code" href="group___sprite.html#ga47">00863</a> <span class="preprocessor">#define PA_SetSpritePal(screen, obj, pal) PA_obj[screen][obj].atr2 = (PA_obj[screen][obj].atr2 &amp; ALL_BUT_PAL) + ((pal) &lt;&lt; 12)</span>
00864 <span class="preprocessor"></span>
<a name="l00876"></a><a class="code" href="group___sprite.html#ga48">00876</a> <span class="preprocessor">#define PA_GetSpritePal(screen, obj) (PA_obj[screen][obj].atr2 &gt;&gt; 12)</span>
00877 <span class="preprocessor"></span>
00878 
<a name="l00893"></a><a class="code" href="group___sprite.html#ga49">00893</a> <span class="preprocessor">#define PA_SetSpriteDblsize(screen, obj, dblsize) PA_obj[screen][obj].atr0 = (PA_obj[screen][obj].atr0 &amp; ALL_BUT(DBLSIZE)) + ((dblsize) &lt;&lt; 9)</span>
00894 <span class="preprocessor"></span>
<a name="l00906"></a><a class="code" href="group___sprite.html#ga50">00906</a> <span class="preprocessor">#define PA_GetSpriteDblsize(screen, obj) ((PA_obj[screen][obj].atr0 &amp; DBLSIZE) &gt;&gt; 9)</span>
00907 <span class="preprocessor"></span>
00908 
<a name="l00923"></a><a class="code" href="group___sprite.html#ga51">00923</a> <span class="preprocessor">#define PA_SetSpriteColors(screen, sprite, n_colors) PA_obj[screen][sprite].atr0 = (PA_obj[screen][sprite].atr0 &amp; ALL_BUT(N_COLORS)) + ((n_colors) &lt;&lt; 13)</span>
00924 <span class="preprocessor"></span>
<a name="l00936"></a><a class="code" href="group___sprite.html#ga52">00936</a> <span class="preprocessor">#define PA_GetSpriteColors(screen, sprite) ((PA_obj[screen][sprite].atr0 &amp; N_COLORS) &gt;&gt; 13)</span>
00937 <span class="preprocessor"></span>
00938 
00939 
<a name="l00954"></a><a class="code" href="group___sprite.html#ga53">00954</a> <span class="preprocessor">#define PA_SetSpriteMode(screen, sprite, obj_mode) PA_obj[screen][sprite].atr0 = (PA_obj[screen][sprite].atr0 &amp; ALL_BUT(OBJ_MODE)) + ((obj_mode) &lt;&lt; 10)</span>
00955 <span class="preprocessor"></span>
<a name="l00967"></a><a class="code" href="group___sprite.html#ga54">00967</a> <span class="preprocessor">#define PA_GetSpriteMode(screen, obj) ((PA_obj[screen][obj].atr0 &amp; OBJ_MODE) &gt;&gt; 10)</span>
00968 <span class="preprocessor"></span>
00969 
<a name="l00984"></a><a class="code" href="group___sprite.html#ga55">00984</a> <span class="preprocessor">#define PA_SetSpriteMosaic(screen, obj, mosaic) PA_obj[screen][obj].atr0 = (PA_obj[screen][obj].atr0 &amp; ALL_BUT(OBJ_MOSAIC)) + ((mosaic) &lt;&lt; 12)</span>
00985 <span class="preprocessor"></span>
<a name="l00997"></a><a class="code" href="group___sprite.html#ga56">00997</a> <span class="preprocessor">#define PA_GetSpriteMosaic(screen, obj) ((PA_obj[screen][obj].atr0 &amp; OBJ_MOSAIC) &gt;&gt; 12)</span>
00998 <span class="preprocessor"></span>
00999 
01000 
<a name="l01015"></a><a class="code" href="group___sprite.html#ga57">01015</a> <span class="preprocessor">#define PA_SetSpriteHflip(screen, obj, hflip) PA_obj[screen][obj].atr1 = (PA_obj[screen][obj].atr1 &amp; ALL_BUT(OBJ_HFLIP)) + ((hflip) &lt;&lt; 12)</span>
01016 <span class="preprocessor"></span>
<a name="l01028"></a><a class="code" href="group___sprite.html#ga58">01028</a> <span class="preprocessor">#define PA_GetSpriteHflip(screen, obj) ((PA_obj[screen][obj].atr1 &amp; OBJ_HFLIP) &gt;&gt; 12)</span>
01029 <span class="preprocessor"></span>
01030 
<a name="l01045"></a><a class="code" href="group___sprite.html#ga59">01045</a> <span class="preprocessor">#define PA_SetSpriteVflip(screen, obj, vflip) PA_obj[screen][obj].atr1 = (PA_obj[screen][obj].atr1 &amp; ALL_BUT(OBJ_VFLIP)) + ((vflip) &lt;&lt; 13)</span>
01046 <span class="preprocessor"></span>
<a name="l01058"></a><a class="code" href="group___sprite.html#ga60">01058</a> <span class="preprocessor">#define PA_GetSpriteVflip(screen, obj) ((PA_obj[screen][obj].atr1 &amp; OBJ_VFLIP) &gt;&gt; 13)</span>
01059 <span class="preprocessor"></span>
01060 
<a name="l01075"></a><a class="code" href="group___sprite.html#ga61">01075</a> <span class="preprocessor">#define PA_SetSpriteGfx(screen, obj, gfx) PA_obj[screen][obj].atr2 = (PA_obj[screen][obj].atr2 &amp; ALL_BUT(OBJ_GFX)) + ((gfx) &amp; OBJ_GFX)</span>
01076 <span class="preprocessor"></span>
<a name="l01088"></a><a class="code" href="group___sprite.html#ga62">01088</a> <span class="preprocessor">#define PA_GetSpriteGfx(screen, obj) (PA_obj[screen][obj].atr2 &amp; OBJ_GFX)</span>
01089 <span class="preprocessor"></span>
01090 
01091 
<a name="l01106"></a><a class="code" href="group___sprite.html#ga63">01106</a> <span class="preprocessor">#define PA_SetSpritePrio(screen, obj, prio) PA_obj[screen][obj].atr2 = (PA_obj[screen][obj].atr2 &amp; ALL_BUT(OBJ_PRIO)) + ((prio) &lt;&lt; 10)</span>
01107 <span class="preprocessor"></span>
<a name="l01119"></a><a class="code" href="group___sprite.html#ga64">01119</a> <span class="preprocessor">#define PA_GetSpritePrio(screen, obj) ((PA_obj[screen][obj].atr2 &amp; OBJ_PRIO) &gt;&gt; 10)</span>
01120 <span class="preprocessor"></span>
01121 
<a name="l01133"></a><a class="code" href="group___sprite.html#ga65">01133</a> <span class="preprocessor">#define PA_GetSpriteLx(screen, sprite) PA_size[PA_obj[screen][sprite].atr0 &gt;&gt; 14][PA_obj[screen][sprite].atr1 &gt;&gt; 14].lx</span>
01134 <span class="preprocessor"></span>
01135 
<a name="l01147"></a><a class="code" href="group___sprite.html#ga66">01147</a> <span class="preprocessor">#define PA_GetSpriteLy(screen, sprite)PA_size[PA_obj[screen][sprite].atr0 &gt;&gt; 14][PA_obj[screen][sprite].atr1 &gt;&gt; 14].ly</span>
01148 <span class="preprocessor"></span>
01149 
<a name="l01164"></a><a class="code" href="group___sprite.html#ga67">01164</a> <span class="preprocessor">#define PA_CloneSprite(screen, obj, target) {PA_obj[screen][obj].atr0 = PA_obj[screen][target].atr0; PA_obj[screen][obj].atr1 = PA_obj[screen][target].atr1; PA_obj[screen][obj].atr2 = PA_obj[screen][target].atr2; ++obj_per_gfx[screen][PA_GetSpriteGfx(screen, target)];}</span>
01165 <span class="preprocessor"></span>
01166 
01167 
01168 
01169 
01170 
01171 
01172 
<a name="l01196"></a><a class="code" href="group___sprite.html#ga19">01196</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga19">PA_SetSpriteAnimEx</a>(u8 screen, u8 sprite, u8 lx, u8 ly, u8 ncolors, s16 animframe){
01197        u16 gfx = <a class="code" href="group___sprite.html#ga62">PA_GetSpriteGfx</a>(screen, sprite);
01198        <span class="comment">//PA_OutputText(1, 0, PA_Rand()&amp;15, "%03d - %03d   ", gfx, sprite);</span>
01199        <a class="code" href="group___sprite.html#ga11">PA_UpdateGfx</a>(screen, gfx, (<span class="keywordtype">void</span>*)(PA_SpriteAnimP[screen][gfx] + (animframe * (lx * ly) &gt;&gt; (2 - ncolors))));
01200 }
01201 
<a name="l01216"></a><a class="code" href="group___sprite.html#ga20">01216</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga20">PA_SetSpriteAnim</a>(u8 screen, u8 sprite, s16 animframe){
01217        <a class="code" href="group___sprite.html#ga19">PA_SetSpriteAnimEx</a>(screen, sprite, <a class="code" href="group___sprite.html#ga65">PA_GetSpriteLx</a>(screen, sprite), <a class="code" href="group___sprite.html#ga66">PA_GetSpriteLy</a>(screen, sprite), <a class="code" href="group___sprite.html#ga52">PA_GetSpriteColors</a>(screen, sprite), animframe);
01218 }
01219 
01220 
01221 
01248 <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga21">PA_StartSpriteAnimEx</a>(u8 screen, u8 sprite, s16 firstframe, s16 lastframe, s16 speed, u8 type, s16 ncycles);
01249 
01250 
01251 
01252 
<a name="l01273"></a><a class="code" href="group___sprite.html#ga22">01273</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga22">PA_StartSpriteAnim</a>(u8 screen, u8 sprite, s16 firstframe, s16 lastframe, s16 speed){
01274        <a class="code" href="group___sprite.html#ga21">PA_StartSpriteAnimEx</a>(screen, sprite, firstframe, lastframe, speed, ANIM_INFINITE);
01275 }
01276 
01277 
01278 
01279 
<a name="l01291"></a><a class="code" href="group___sprite.html#ga23">01291</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga23">PA_StopSpriteAnim</a>(u8 screen, u8 sprite)
01292 {
01293        <span class="keywordflow">if</span> (spriteanims[screen][sprite].play) nspriteanims--;
01294        spriteanims[screen][sprite].play = 0;
01295 }
01296 
<a name="l01311"></a><a class="code" href="group___sprite.html#ga24">01311</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga24">PA_SetSpriteAnimFrame</a>(u8 screen, u8 sprite, u16 frame)
01312 {
01313        <span class="keywordflow">if</span>(spriteanims[screen][sprite].currentframe != frame){
01314               <a class="code" href="group___sprite.html#ga19">PA_SetSpriteAnimEx</a>(screen, sprite, spriteanims[screen][sprite].lx, spriteanims[screen][sprite].ly, spriteanims[screen][sprite].colors, spriteanims[screen][sprite].currentframe);
01315               spriteanims[screen][sprite].currentframe = frame;
01316        }
01317 }
01318 
01319 
<a name="l01331"></a><a class="code" href="group___sprite.html#ga25">01331</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u16 <a class="code" href="group___sprite.html#ga25">PA_GetSpriteAnimFrame</a>(u8 screen, u8 sprite)
01332 {
01333        <span class="keywordflow">return</span> spriteanims[screen][sprite].currentframe;
01334 }
01335 
01336 
01337 
<a name="l01352"></a><a class="code" href="group___sprite.html#ga26">01352</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga26">PA_SetSpriteAnimSpeed</a>(u8 screen, u8 sprite, s16 speed)
01353 {
01354        spriteanims[screen][sprite].speed = speed;
01355 }
01356 
<a name="l01368"></a><a class="code" href="group___sprite.html#ga27">01368</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u16 <a class="code" href="group___sprite.html#ga27">PA_GetSpriteAnimSpeed</a>(u8 screen, u8 sprite)
01369 {
01370        <span class="keywordflow">return</span> spriteanims[screen][sprite].speed;
01371 }
01372 
01373 
<a name="l01388"></a><a class="code" href="group___sprite.html#ga28">01388</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga28">PA_SetSpriteNCycles</a>(u8 screen, u8 sprite, s16 NCycles)
01389 {
01390        spriteanims[screen][sprite].ncycles = NCycles;
01391 }
01392 
01393 
01394 
<a name="l01406"></a><a class="code" href="group___sprite.html#ga29">01406</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u16 <a class="code" href="group___sprite.html#ga29">PA_GetSpriteNCycles</a>(u8 screen, u8 sprite)
01407 {
01408        <span class="keywordflow">return</span> spriteanims[screen][sprite].speed;
01409 }
01410 
01411 
01412 
01413 
01414 
<a name="l01429"></a><a class="code" href="group___sprite.html#ga30">01429</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga30">PA_SpriteAnimPause</a>(u8 screen, u8 sprite, u8 pause)
01430 {
01431        <span class="keywordflow">if</span> (pause&amp;&amp;spriteanims[screen][sprite].play) nspriteanims--;
01432        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!pause)&amp;&amp;(!spriteanims[screen][sprite].play)) nspriteanims++;
01433        spriteanims[screen][sprite].play = !pause;
01434 }
01435 
01436 
01437 
01438 
01439 
01440 
<a name="l01461"></a><a class="code" href="group___sprite.html#ga31">01461</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga31">PA_SetSpritePixel</a>(u8 screen, u8 sprite, u8 x, u8 y, u8 color){
01462 u8 hsize = spriteanims[screen][sprite].lx&gt;&gt;3;
01463 
01464        s32 pos = (x &gt;&gt; 3) + ((y &gt;&gt; 3) * hsize);
01465        x&amp;=7; y&amp;=7;
01466        
01467        pos = (pos &lt;&lt; 5) + (x &gt;&gt; 1) + (y &lt;&lt; 2);
01468        
01469        u16 pixel = spriteanims[screen][sprite].gfx[pos];
01470        
01471        <span class="keywordflow">if</span> (x&amp;1){
01472               spriteanims[screen][sprite].gfx[pos] = (color &lt;&lt; 8) | (pixel&amp;0x00FF);               
01473        }
01474        <span class="keywordflow">else</span> {
01475               spriteanims[screen][sprite].gfx[pos] = color | (pixel&amp;0xFF00); 
01476        }
01477 }
01478 
01479 
<a name="l01497"></a><a class="code" href="group___sprite.html#ga32">01497</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___sprite.html#ga32">PA_GetSpritePixel</a>(u8 screen, u8 sprite, u8 x, u8 y) {
01498 u8 hsize = spriteanims[screen][sprite].lx&gt;&gt;3;
01499 
01500        s32 pos = (x &gt;&gt; 3) + ((y &gt;&gt; 3) * hsize);
01501        x&amp;=7; y&amp;=7;
01502        
01503        pos = (pos &lt;&lt; 5) + (x &gt;&gt; 1) + (y &lt;&lt; 2);
01504        
01505        u16 pixel = spriteanims[screen][sprite].gfx[pos];
01506        
01507        <span class="keywordflow">if</span> (x&amp;1){
01508               <span class="keywordflow">return</span> ((pixel&gt;&gt;8)&amp;255);                  
01509        }
01510        <span class="keywordflow">else</span> {
01511               <span class="keywordflow">return</span> (pixel&amp;255);
01512        }
01513 }
01514 
<a name="l01532"></a><a class="code" href="group___sprite.html#ga33">01532</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___sprite.html#ga33">PA_GetSprite16cPixel</a>(u8 screen, u8 sprite, u8 x, u8 y) {
01533        u8 hsize = spriteanims[screen][sprite].lx&gt;&gt;3;
01534 
01535        s32 pos = (x &gt;&gt; 3) + ((y &gt;&gt; 3) * hsize);
01536        x&amp;=7; y&amp;=7;
01537        
01538        pos = (pos &lt;&lt; 4) + (x &gt;&gt; 2) + (y &lt;&lt; 1);
01539        
01540        u16 pixel = spriteanims[screen][sprite].gfx[pos];
01541        <span class="keywordflow">return</span> ((pixel&gt;&gt;(4*(x&amp;3)))&amp;15);    
01542 }
01543 
01544 
01545 
01557 <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga34">PA_InitSpriteDraw</a>(u8 screen, u8 sprite);
01558 
01559 
01560 
<a name="l01566"></a><a class="code" href="group___sprite.html#ga35">01566</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga35">PA_InitAllSpriteDraw</a>(<span class="keywordtype">void</span>){
01567 u8 i, j;
01568 <span class="keywordflow">for</span> (j = 0; j &lt; 2; j++)
01569        <span class="keywordflow">for</span> (i = 0; i &lt; 128; i++)
01570               <a class="code" href="group___sprite.html#ga34">PA_InitSpriteDraw</a>(j, i);
01571 }
01572 
01573 
01574 
01575 
01584 <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga36">PA_InitSpriteExtPrio</a>(u8 SpritePrio);
01585 
01586 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> PA_SetSpriteExtPrio(u8 screen, u8 sprite, u8 prio){
01587        PA_SpritePrio[screen][sprite] = prio;
01588 }
01589 
01590 
01591 
01592  <span class="comment">// end of Sprite</span>
01594 
01595 
01596 
01597 
01598 
01599 <span class="keywordtype">void</span> PA_UpdateSpriteAnims(<span class="keywordtype">void</span>);
01600 
01601 
01602 
01603 
01604 
01605 
01606 <span class="preprocessor">#ifdef __cplusplus</span>
01607 <span class="preprocessor"></span>}
01608 <span class="preprocessor">#endif</span>
01609 <span class="preprocessor"></span>
01610 
01611 
01612 
01613 <span class="preprocessor">#endif</span>
01614 <span class="preprocessor"></span>
01615 
</pre></div><hr size="1"><address style="align: right;"><small>Généré le Tue Jan 30 23:10:49 2007 pour PAlib par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
