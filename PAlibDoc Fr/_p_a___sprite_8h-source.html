<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PAlib:  Fichier source de PA_Sprite.h</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Généré par Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Page&nbsp;principale</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">Liste&nbsp;des&nbsp;fichiers</a> | <a class="qindex" href="globals.html">Portée&nbsp;globale</a>  | <span class="search">Rechercher&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>PA_Sprite.h</h1><a href="_p_a___sprite_8h.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef _PA_Sprite</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define _PA_Sprite</span>
00003 <span class="preprocessor"></span>
00004 
00005 
00012 <span class="comment">//#include "../PA.h"</span>
00013 
00014 
00015 <span class="preprocessor">#define EWRAM_DATA   __attribute__((section(".ewram")))</span>
00016 <span class="preprocessor"></span><span class="preprocessor">#define EWRAM_BSS    __attribute__((section(".sbss")))</span>
00017 <span class="preprocessor"></span><span class="preprocessor">#define PA_Cos(angle) PA_SIN[((angle) + 128)&amp;511]</span>
00018 <span class="preprocessor"></span><span class="preprocessor">#define PA_Sin(angle) PA_SIN[((angle))&amp;511]</span>
00019 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="keyword">const</span> s16 PA_SIN[512]; 
00020 
00021 <span class="preprocessor">#define MAX_DRAW 16  // Maximum 16 sprites dessinables...</span>
00022 <span class="preprocessor"></span>
00023 
00025 <span class="comment">// Système de sprites</span>
00027 <span class="comment"></span>
00028 
00029 <span class="preprocessor">#define OBJ_SIZE_8X8      0,0</span>
00030 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_16X16    0,1</span>
00031 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_32X32    0,2</span>
00032 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_64X64    0,3</span>
00033 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_16X8     1,0</span>
00034 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_32X8     1,1</span>
00035 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_32X16    1,2</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_64X32    1,3</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_8X16     2,0</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_8X32     2,1</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_16X32    2,2</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_SIZE_32X64    2,3</span>
00041 <span class="preprocessor"></span>
00042 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00043        u8 lx, ly;
00044 } PA_sizes;
00045 
00046 <span class="keyword">extern</span> <span class="keyword">const</span> PA_sizes PA_size[3][4];
00047 
00048 
00049 <span class="preprocessor">#define BITS_16 65535</span>
00050 <span class="preprocessor"></span><span class="preprocessor">#define ALL_BUT(ATR) (BITS_16 - ATR)</span>
00051 <span class="preprocessor"></span>
00052 <span class="preprocessor">#define OBJ_X 511 //511, debugging...</span>
00053 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_Y 255</span>
00054 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_ROT 256</span>
00055 <span class="preprocessor"></span><span class="preprocessor">#define ALL_BUT_ROTSET 49663  // Numéro du rotset</span>
00056 <span class="preprocessor"></span><span class="preprocessor">#define ALL_BUT_PAL 4095</span>
00057 <span class="preprocessor"></span>
00058 <span class="preprocessor">#define DBLSIZE 512</span>
00059 <span class="preprocessor"></span><span class="preprocessor">#define N_COLORS (1 &lt;&lt; 13)</span>
00060 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_MODE 3072</span>
00061 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_MOSAIC 4096</span>
00062 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_HFLIP 4096</span>
00063 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_VFLIP 8192</span>
00064 <span class="preprocessor"></span>
00065 <span class="preprocessor">#define OBJ_GFX 1023</span>
00066 <span class="preprocessor"></span><span class="preprocessor">#define OBJ_PRIO 3072</span>
00067 <span class="preprocessor"></span>
00068 <span class="preprocessor">#define COLORS_256 1</span>
00069 <span class="preprocessor"></span><span class="preprocessor">#define COLORS_16 0</span>
00070 <span class="preprocessor"></span>
00071 
00072 
00073 <span class="preprocessor">#define MEM_DECAL 5</span>
00074 <span class="preprocessor"></span><span class="preprocessor">#define NUMBER_DECAL 7</span>
00075 <span class="preprocessor"></span>
00076 
00077 
00078 <span class="comment">// Mémoire gfx</span>
00079 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00080    u16 mem_block;  <span class="comment">// Emplacement en mémoire, de 0 à 1023</span>
00081    u16 free; <span class="comment">// Doonées libres en ce point</span>
00082 } mem_usage;
00083 
00084 <span class="keyword">extern</span> u16 n_free_mem[2]; <span class="comment">// nombre d'emplacements libres</span>
00085 <span class="keyword">extern</span> u8 used_mem[2][1024]; <span class="comment">// Note la quantité de mémoire utilisée en chaque point de la mémoire pour pouvoir effacer les gfx...</span>
00086 <span class="keyword">extern</span> u8 obj_per_gfx[2][1024]; <span class="comment">// Nombre de sprites utilisant un gfx donné...</span>
00087 <span class="keyword">extern</span> mem_usage free_mem[2][1024];
00088 
00089 <span class="keyword">extern</span> u16 FirstGfx[2];
00090 
00091 <span class="keyword">extern</span> <span class="keyword">const</span> u16 PA_obj_sizes[4][3];
00092 
00093 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00094    u16 atr0, atr1, atr2, atr3;
00095 }obj_inf;
00096 <span class="keyword">extern</span> obj_inf PA_obj[2][128];  <span class="comment">// Les 128 premiers pour l'écran du haut, et encore 128 pour l'écran du bas...</span>
00097 
00098 
00099 <span class="comment">// Infos pour dessiner sur les sprites</span>
00100 
00101 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00102        <span class="keywordtype">bool</span> screen; <span class="comment">// Ecran</span>
00103        u8 sprite;           <span class="comment">// Numéro du sprite</span>
00104        <span class="keywordtype">bool</span> wasdrawing; <span class="comment">// Si on dessinait dessus ou pas avant</span>
00105        s8 x, y;  <span class="comment">// Position x et y d'avant</span>
00106        u8 hsize, vsize; <span class="comment">// Tailles</span>
00107        u8 n_colors; <span class="comment">// Nombre de couleurs</span>
00108        u8 drawsize;
00109        u32 *gfxpointer; <span class="comment">// Pour dessiner à l'écran directement</span>
00110 } PA_DrawSprites;
00111 
00112 
00113 
00114 <span class="keyword">extern</span> PA_DrawSprites PA_DrawSprite[MAX_DRAW];
00115 
00116 <span class="comment">// Pour le dessin sur sprite</span>
00117 <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *PA_SpriteBuffer[MAX_DRAW]; <span class="comment">// Pointeurs vers les buffers  que l'on créera à la volée</span>
00118 
00119 <span class="keyword">extern</span> u16 *PA_SpriteAnimP[2][1024];
00120 
00121 
00122 <span class="keyword">extern</span> s16 nspriteanims; <span class="comment">// Number of animated sprites currently...</span>
00123 <span class="keyword">typedef</span> <span class="keyword">struct</span>{
00124        u16 firstframe, lastframe, currentframe; <span class="comment">// frames...</span>
00125        u16 time; <span class="comment">// Time...</span>
00126        u8 lx, ly; <span class="comment">// Sprite sizes</span>
00127        <span class="keywordtype">bool</span> colors; 
00128        s16 speed;
00129        <span class="keywordtype">bool</span> play;
00130        u16 *gfx; <span class="comment">// gfx pointer</span>
00131 } spriteanim;
00132 <span class="keyword">extern</span> spriteanim spriteanims[2][128]; <span class="comment">// Init the array on PAlib init...</span>
00133 
00134 <span class="comment">//#define spriteanimsize 40</span>
00135 
00136 
00137 
00138 
00139 
00140 
00141 
00142 
00143 
00144 
00145 <span class="preprocessor">#define OAM0 0x07000000</span>
00146 <span class="preprocessor"></span><span class="preprocessor">#define OAM1 0x07000400</span>
00147 <span class="preprocessor"></span>
00148 
00160 <span class="comment">//#define PA_UpdateOAM() DMA_Copy((void*)PA_obj, (void*)OAM0, 512, DMA_32NOW)</span>
<a name="l00161"></a><a class="code" href="group___sprite.html#ga29">00161</a> <span class="preprocessor">#define PA_UpdateOAM()s16 i;\</span>
00162 <span class="preprocessor">       for (i = 0; i &lt; 256; i++) {\</span>
00163 <span class="preprocessor">              OAM[(i &lt;&lt; 2)] = PA_obj[0][i].atr0;\</span>
00164 <span class="preprocessor">              OAM[1+(i &lt;&lt; 2)] = PA_obj[0][i].atr1;\</span>
00165 <span class="preprocessor">              OAM[2+(i &lt;&lt; 2)] = PA_obj[0][i].atr2;\</span>
00166 <span class="preprocessor">              OAM[3+(i &lt;&lt; 2)] = PA_obj[0][i].atr3;}</span>
00167 <span class="preprocessor"></span>
00168 
<a name="l00174"></a><a class="code" href="group___sprite.html#ga30">00174</a> <span class="preprocessor">#define PA_UpdateOAM0() DMA_Copy((void*)PA_obj, (void*)OAM0, 256, DMA_32NOW)</span>
00175 <span class="preprocessor"></span>
<a name="l00181"></a><a class="code" href="group___sprite.html#ga31">00181</a> <span class="preprocessor">#define PA_UpdateOAM1() DMA_Copy((void*)PA_obj + 256, (void*)OAM1, 256, DMA_32NOW)</span>
00182 <span class="preprocessor"></span>
00183 
00205 u16 <a class="code" href="group___sprite.html#ga0">PA_CreateGfx</a>(<span class="keywordtype">bool</span> screen, <span class="keywordtype">void</span>* obj_data, u8 obj_shape, u8 obj_size, u8 color_mode);
00206 
00212 <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga1">PA_ResetSpriteSys</a>(<span class="keywordtype">void</span>);
00213 
00214 
00215 
<a name="l00248"></a><a class="code" href="group___sprite.html#ga2">00248</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga2">PA_CreateSprite</a>(<span class="keywordtype">bool</span> screen, u8 obj_number, <span class="keywordtype">void</span>* obj_data, u8 obj_shape, u8 obj_size, u8 color_mode, u8 palette, s16 x, s16 y) {
00249    PA_obj[screen][obj_number].atr2 = <a class="code" href="group___sprite.html#ga0">PA_CreateGfx</a>(screen, obj_data, obj_shape, obj_size, color_mode) + (palette &lt;&lt; 12);
00250    PA_obj[screen][obj_number].atr0 = (y&amp;OBJ_Y) + (color_mode &lt;&lt; 13) + (obj_shape &lt;&lt; 14);
00251    PA_obj[screen][obj_number].atr1 = (x &amp; OBJ_X) + (obj_size &lt;&lt; 14);
00252 };
00253 
<a name="l00304"></a><a class="code" href="group___sprite.html#ga3">00304</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga3">PA_CreateSpriteEx</a>(<span class="keywordtype">bool</span> screen, u8 obj_number, <span class="keywordtype">void</span>* obj_data, u8 obj_shape, u8 obj_size, u8 color_mode, u8 palette, u8 obj_mode, <span class="keywordtype">bool</span> mosaic, <span class="keywordtype">bool</span> hflip, <span class="keywordtype">bool</span> vflip, u8 prio, <span class="keywordtype">bool</span> dblsize, s16 x, s16 y) {
00305    PA_obj[screen][obj_number].atr2 = <a class="code" href="group___sprite.html#ga0">PA_CreateGfx</a>(screen, obj_data, obj_shape, obj_size, color_mode) + (prio &lt;&lt; 10) + (palette &lt;&lt; 12);
00306    PA_obj[screen][obj_number].atr0 = (y&amp;OBJ_Y) + (dblsize &lt;&lt; 9) + (obj_mode &lt;&lt; 10) + (mosaic &lt;&lt; 12) + ((color_mode) &lt;&lt; 13) + (obj_shape &lt;&lt; 14);
00307    PA_obj[screen][obj_number].atr1 = (x &amp; OBJ_X) + (hflip &lt;&lt; 12) + (vflip &lt;&lt; 13) + (obj_size &lt;&lt; 14);
00308 };
00309 
00310 
00311 
00312 
00313 
<a name="l00355"></a><a class="code" href="group___sprite.html#ga4">00355</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga4">PA_Create16bitSpriteEx</a>(<span class="keywordtype">bool</span> screen, u8 obj_number, <span class="keywordtype">void</span>* obj_data, u8 obj_shape, u8 obj_size, <span class="keywordtype">bool</span> mosaic, <span class="keywordtype">bool</span> hflip, <span class="keywordtype">bool</span> vflip, u8 prio, <span class="keywordtype">bool</span> dblsize, s16 x, s16 y){
00356 u16 mem_size = PA_obj_sizes[obj_size][obj_shape] &lt;&lt; 1;
00357 u16 *gfx = (u16*)malloc(mem_size);
00358 mem_size = mem_size &gt;&gt; 1;
00359 s32 i;
00360 u16 *data = (u16*)obj_data;
00361 <span class="keywordflow">for</span> (i = 0; i &lt; mem_size; i++) gfx[i] = data[i] + (1 &lt;&lt; 15);
00362 
00363    PA_obj[screen][obj_number].atr2 = <a class="code" href="group___sprite.html#ga0">PA_CreateGfx</a>(screen, gfx, obj_shape, obj_size, 2) + (prio &lt;&lt; 10) + (15 &lt;&lt; 12);
00364    PA_obj[screen][obj_number].atr0 = (y&amp;OBJ_Y) + (dblsize &lt;&lt; 9) + (3 &lt;&lt; 10) + (mosaic &lt;&lt; 12) + (0 &lt;&lt; 13) + (obj_shape &lt;&lt; 14);
00365    PA_obj[screen][obj_number].atr1 = (x &amp; OBJ_X) + (hflip &lt;&lt; 12) + (vflip &lt;&lt; 13) + (obj_size &lt;&lt; 14);
00366 
00367 free(gfx);
00368 }
00369 
00370 
00371 
<a name="l00398"></a><a class="code" href="group___sprite.html#ga5">00398</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga5">PA_Create16bitSprite</a>(<span class="keywordtype">bool</span> screen, u8 obj_number, <span class="keywordtype">void</span>* obj_data, u8 obj_shape, u8 obj_size, s16 x, s16 y){
00399 <a class="code" href="group___sprite.html#ga4">PA_Create16bitSpriteEx</a>(screen, obj_number, obj_data, obj_shape, obj_size, 0, 0, 0, 0, 0, x, y);
00400 }
00401 
00402 
00403 
00404 
<a name="l00437"></a><a class="code" href="group___sprite.html#ga6">00437</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga6">PA_CreateSpriteFromGfx</a>(<span class="keywordtype">bool</span> screen, u8 obj_number, u16 obj_gfx, u8 obj_shape, u8 obj_size, u8 color_mode, u8 palette, s16 x, s16 y) {
00438    PA_obj[screen][obj_number].atr2 = obj_gfx + (palette &lt;&lt; 12);
00439    PA_obj[screen][obj_number].atr0 = (y&amp;OBJ_Y) + (color_mode &lt;&lt; 13) + (obj_shape &lt;&lt; 14);
00440    PA_obj[screen][obj_number].atr1 = (x &amp; OBJ_X) + (obj_size &lt;&lt; 14);
00441    ++obj_per_gfx[screen][obj_gfx];
00442 };
00443 
<a name="l00494"></a><a class="code" href="group___sprite.html#ga7">00494</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga7">PA_CreateSpriteExFromGfx</a>(<span class="keywordtype">bool</span> screen, u8 obj_number, u16 obj_gfx, u8 obj_shape, u8 obj_size, u8 color_mode, u8 palette, u8 obj_mode, <span class="keywordtype">bool</span> mosaic, <span class="keywordtype">bool</span> hflip, <span class="keywordtype">bool</span> vflip, u8 prio, <span class="keywordtype">bool</span> dblsize, s16 x, s16 y) {
00495    PA_obj[screen][obj_number].atr2 = obj_gfx + (prio &lt;&lt; 10) + (palette &lt;&lt; 12);
00496    PA_obj[screen][obj_number].atr0 = (y&amp;OBJ_Y) + (dblsize &lt;&lt; 9) + (obj_mode &lt;&lt; 10) + (mosaic &lt;&lt; 12) + (color_mode &lt;&lt; 13) + (obj_shape &lt;&lt; 14);
00497    PA_obj[screen][obj_number].atr1 = (x &amp; OBJ_X) + (hflip &lt;&lt; 12) + (vflip &lt;&lt; 13) + (obj_size &lt;&lt; 14);
00498    ++obj_per_gfx[screen][obj_gfx];
00499 };
00500 
00501 
<a name="l00516"></a><a class="code" href="group___sprite.html#ga32">00516</a> <span class="preprocessor">#define PA_UpdateSpriteGfx(screen, obj_number, obj_data) PA_UpdateGfx(screen, PA_GetSpriteGfx(screen, obj_number), obj_data)</span>
00517 <span class="preprocessor"></span>
00532 <span class="preprocessor">#include "<a class="code" href="_p_a___text_8h.html">PA_Text.h</a>"</span>
00533 <span class="preprocessor">#include "PA_Math.h"</span>
00534 
<a name="l00535"></a><a class="code" href="group___sprite.html#ga8">00535</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga8">PA_UpdateGfx</a>(<span class="keywordtype">bool</span> screen, u16 gfx_number, <span class="keywordtype">void</span> *obj_data) {
00536        DMA_Copy((obj_data), (<span class="keywordtype">void</span>*)(SPRITE_GFX1 + (0x200000 *  (screen)) + ((gfx_number) &lt;&lt; NUMBER_DECAL)), (used_mem[screen][gfx_number] &lt;&lt; MEM_DECAL), DMA_32NOW);
00537 <span class="comment">//     PA_OutputText(1, 25, PA_Rand()&amp;15, "%dgfx   ", gfx_number);</span>
00538 }
00539 
00540 
<a name="l00556"></a><a class="code" href="group___sprite.html#ga9">00556</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga9">PA_UpdateGfxAndMem</a>(<span class="keywordtype">bool</span> screen, u8 gfx_number, <span class="keywordtype">void</span> *obj_data){
00557        DMA_Copy((obj_data), (<span class="keywordtype">void</span>*)(SPRITE_GFX1 + (0x200000 *  (screen)) + ((gfx_number) &lt;&lt; NUMBER_DECAL)), (used_mem[screen][gfx_number] &lt;&lt; MEM_DECAL), DMA_32NOW);
00558        PA_SpriteAnimP[screen][gfx_number] = (u16*)obj_data; <span class="comment">// mémorise la source de l'image...</span>
00559 }
00560 
00561 
00562 
00563 
00575 <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga10">PA_DeleteGfx</a>(<span class="keywordtype">bool</span> screen, u16 obj_gfx);
00576 
00577 
00589 <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga11">PA_DeleteSprite</a>(<span class="keywordtype">bool</span> screen, u8 obj_number);
00590 
00591 
<a name="l00607"></a><a class="code" href="group___sprite.html#ga33">00607</a> <span class="preprocessor">#define PA_SetSpriteRotEnable(screen, sprite, rotset) {PA_obj[screen][sprite].atr0 |= OBJ_ROT;  PA_obj[screen][sprite].atr1 = (PA_obj[screen][sprite].atr1 &amp; ALL_BUT_ROTSET) + ((rotset) &lt;&lt; 9);}</span>
00608 <span class="preprocessor"></span>
<a name="l00620"></a><a class="code" href="group___sprite.html#ga34">00620</a> <span class="preprocessor">#define PA_SetSpriteRotDisable(screen, sprite) {PA_obj[screen][sprite].atr0 &amp;= ALL_BUT(OBJ_ROT);  PA_obj[screen][sprite].atr1 &amp;= ALL_BUT_ROTSET;}</span>
00621 <span class="preprocessor"></span>
00622 
<a name="l00644"></a><a class="code" href="group___sprite.html#ga12">00644</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga12">PA_SetRotset</a>(<span class="keywordtype">bool</span> screen, u8 rotset, s16 angle, u16 zoomx, u16 zoomy) {
00645 u8 obj_num = (rotset &lt;&lt; 2);
00646        PA_obj[screen][obj_num].atr3 = (<a class="code" href="group___math.html#ga10">PA_Cos</a>(angle) * zoomx) &gt;&gt; 8;
00647        PA_obj[screen][obj_num + 1].atr3 = (-<a class="code" href="group___math.html#ga11">PA_Sin</a>(angle) * zoomy) &gt;&gt; 8;
00648        PA_obj[screen][obj_num + 2].atr3 = (<a class="code" href="group___math.html#ga11">PA_Sin</a>(angle) * zoomx) &gt;&gt; 8;
00649        PA_obj[screen][obj_num + 3].atr3 = (<a class="code" href="group___math.html#ga10">PA_Cos</a>(angle) * zoomy) &gt;&gt; 8;
00650 }
00651 
<a name="l00666"></a><a class="code" href="group___sprite.html#ga13">00666</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga13">PA_SetRotsetNoZoom</a>(<span class="keywordtype">bool</span> screen, u8 rotset, s16 angle)   {
00667 u8 obj_num = (rotset &lt;&lt; 2);
00668        PA_obj[screen][obj_num].atr3 = <a class="code" href="group___math.html#ga10">PA_Cos</a>(angle);
00669        PA_obj[screen][obj_num + 1].atr3 = -<a class="code" href="group___math.html#ga11">PA_Sin</a>(angle);
00670        PA_obj[screen][obj_num + 2].atr3 = <a class="code" href="group___math.html#ga11">PA_Sin</a>(angle);
00671        PA_obj[screen][obj_num + 3].atr3 = <a class="code" href="group___math.html#ga10">PA_Cos</a>(angle);
00672 }
00673 
<a name="l00691"></a><a class="code" href="group___sprite.html#ga14">00691</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga14">PA_SetRotsetNoAngle</a>(<span class="keywordtype">bool</span> screen, u8 rotset, u16 zoomx, u16 zoomy) {
00692 u8 obj_num = (rotset &lt;&lt; 2);
00693        PA_obj[screen][obj_num].atr3 = zoomx;
00694        PA_obj[screen][obj_num + 1].atr3 = 0;
00695        PA_obj[screen][obj_num + 2].atr3 = 0;
00696        PA_obj[screen][obj_num + 3].atr3 = zoomy;
00697 }
00698 
00699 
00700 
00701 
00702 
00703 
00704 
<a name="l00721"></a><a class="code" href="group___sprite.html#ga35">00721</a> <span class="preprocessor">#define PA_SetSpriteX(screen, obj, x) PA_obj[screen][obj].atr1 = (PA_obj[screen][obj].atr1 &amp; ALL_BUT(OBJ_X)) + ((x) &amp; OBJ_X)</span>
00722 <span class="preprocessor"></span>
<a name="l00735"></a><a class="code" href="group___sprite.html#ga36">00735</a> <span class="preprocessor">#define PA_GetSpriteX(screen, obj) (PA_obj[screen][obj].atr1 &amp; (OBJ_X))</span>
00736 <span class="preprocessor"></span>
00737 
<a name="l00752"></a><a class="code" href="group___sprite.html#ga37">00752</a> <span class="preprocessor">#define PA_SetSpriteY(screen, obj, y) PA_obj[screen][obj].atr0 = (PA_obj[screen][obj].atr0 &amp; ALL_BUT(OBJ_Y)) + ((y) &amp; OBJ_Y)</span>
00753 <span class="preprocessor"></span>
<a name="l00766"></a><a class="code" href="group___sprite.html#ga38">00766</a> <span class="preprocessor">#define PA_GetSpriteY(screen, obj) (PA_obj[screen][obj].atr0 &amp; OBJ_Y)</span>
00767 <span class="preprocessor"></span>
00768 
00769 
<a name="l00787"></a><a class="code" href="group___sprite.html#ga15">00787</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga15">PA_SetSpriteXY</a>(<span class="keywordtype">bool</span> screen, u8 sprite, s16 x, s16 y) {
00788        <a class="code" href="group___sprite.html#ga35">PA_SetSpriteX</a>(screen, sprite, x); 
00789        <a class="code" href="group___sprite.html#ga37">PA_SetSpriteY</a>(screen, sprite, y);
00790 }
00791 
00792 
00793 
<a name="l00808"></a><a class="code" href="group___sprite.html#ga39">00808</a> <span class="preprocessor">#define PA_SetSpritePal(screen, obj, pal) PA_obj[screen][obj].atr2 = (PA_obj[screen][obj].atr2 &amp; ALL_BUT_PAL) + ((pal) &lt;&lt; 12)</span>
00809 <span class="preprocessor"></span>
<a name="l00821"></a><a class="code" href="group___sprite.html#ga40">00821</a> <span class="preprocessor">#define PA_GetSpritePal(screen, obj) (PA_obj[screen][obj].atr2 &gt;&gt; 12)</span>
00822 <span class="preprocessor"></span>
00823 
<a name="l00838"></a><a class="code" href="group___sprite.html#ga41">00838</a> <span class="preprocessor">#define PA_SetSpriteDblsize(screen, obj, dblsize) PA_obj[screen][obj].atr0 = (PA_obj[screen][obj].atr0 &amp; ALL_BUT(DBLSIZE)) + ((dblsize) &lt;&lt; 9)</span>
00839 <span class="preprocessor"></span>
<a name="l00851"></a><a class="code" href="group___sprite.html#ga42">00851</a> <span class="preprocessor">#define PA_GetSpriteDblsize(screen, obj) ((PA_obj[screen][obj].atr0 &amp; DBLSIZE) &gt;&gt; 9)</span>
00852 <span class="preprocessor"></span>
00853 
<a name="l00868"></a><a class="code" href="group___sprite.html#ga43">00868</a> <span class="preprocessor">#define PA_SetSpriteColors(screen, sprite, n_colors) PA_obj[screen][sprite].atr0 = (PA_obj[screen][sprite].atr0 &amp; ALL_BUT(N_COLORS)) + ((n_colors) &lt;&lt; 13)</span>
00869 <span class="preprocessor"></span>
<a name="l00881"></a><a class="code" href="group___sprite.html#ga44">00881</a> <span class="preprocessor">#define PA_GetSpriteColors(screen, sprite) ((PA_obj[screen][sprite].atr0 &amp; N_COLORS) &gt;&gt; 13)</span>
00882 <span class="preprocessor"></span>
00883 
00884 
<a name="l00899"></a><a class="code" href="group___sprite.html#ga45">00899</a> <span class="preprocessor">#define PA_SetSpriteMode(screen, sprite, obj_mode) PA_obj[screen][sprite].atr0 = (PA_obj[screen][sprite].atr0 &amp; ALL_BUT(OBJ_MODE)) + ((obj_mode) &lt;&lt; 10)</span>
00900 <span class="preprocessor"></span>
<a name="l00912"></a><a class="code" href="group___sprite.html#ga46">00912</a> <span class="preprocessor">#define PA_GetSpriteMode(screen, obj) ((PA_obj[screen][obj].atr0 &amp; OBJ_MODE) &gt;&gt; 10)</span>
00913 <span class="preprocessor"></span>
00914 
<a name="l00929"></a><a class="code" href="group___sprite.html#ga47">00929</a> <span class="preprocessor">#define PA_SetSpriteMosaic(screen, obj, mosaic) PA_obj[screen][obj].atr0 = (PA_obj[screen][obj].atr0 &amp; ALL_BUT(OBJ_MOSAIC)) + ((mosaic) &lt;&lt; 12)</span>
00930 <span class="preprocessor"></span>
<a name="l00942"></a><a class="code" href="group___sprite.html#ga48">00942</a> <span class="preprocessor">#define PA_GetSpriteMosaic(screen, obj) ((PA_obj[screen][obj].atr0 &amp; OBJ_MOSAIC) &gt;&gt; 12)</span>
00943 <span class="preprocessor"></span>
00944 
00945 
<a name="l00960"></a><a class="code" href="group___sprite.html#ga49">00960</a> <span class="preprocessor">#define PA_SetSpriteHflip(screen, obj, hflip) PA_obj[screen][obj].atr1 = (PA_obj[screen][obj].atr1 &amp; ALL_BUT(OBJ_HFLIP)) + ((hflip) &lt;&lt; 12)</span>
00961 <span class="preprocessor"></span>
<a name="l00973"></a><a class="code" href="group___sprite.html#ga50">00973</a> <span class="preprocessor">#define PA_GetSpriteHflip(screen, obj) ((PA_obj[screen][obj].atr1 &amp; OBJ_HFLIP) &gt;&gt; 12)</span>
00974 <span class="preprocessor"></span>
00975 
<a name="l00990"></a><a class="code" href="group___sprite.html#ga51">00990</a> <span class="preprocessor">#define PA_SetSpriteVflip(screen, obj, vflip) PA_obj[screen][obj].atr1 = (PA_obj[screen][obj].atr1 &amp; ALL_BUT(OBJ_VFLIP)) + ((vflip) &lt;&lt; 13)</span>
00991 <span class="preprocessor"></span>
<a name="l01003"></a><a class="code" href="group___sprite.html#ga52">01003</a> <span class="preprocessor">#define PA_GetSpriteVflip(screen, obj) ((PA_obj[screen][obj].atr1 &amp; OBJ_VFLIP) &gt;&gt; 13)</span>
01004 <span class="preprocessor"></span>
01005 
<a name="l01020"></a><a class="code" href="group___sprite.html#ga53">01020</a> <span class="preprocessor">#define PA_SetSpriteGfx(screen, obj, gfx) PA_obj[screen][obj].atr2 = (PA_obj[screen][obj].atr2 &amp; ALL_BUT(OBJ_GFX)) + ((gfx) &amp; OBJ_GFX)</span>
01021 <span class="preprocessor"></span>
<a name="l01033"></a><a class="code" href="group___sprite.html#ga54">01033</a> <span class="preprocessor">#define PA_GetSpriteGfx(screen, obj) (PA_obj[screen][obj].atr2 &amp; OBJ_GFX)</span>
01034 <span class="preprocessor"></span>
01035 
01036 
<a name="l01051"></a><a class="code" href="group___sprite.html#ga55">01051</a> <span class="preprocessor">#define PA_SetSpritePrio(screen, obj, prio) PA_obj[screen][obj].atr2 = (PA_obj[screen][obj].atr2 &amp; ALL_BUT(OBJ_PRIO)) + ((prio) &lt;&lt; 10)</span>
01052 <span class="preprocessor"></span>
<a name="l01064"></a><a class="code" href="group___sprite.html#ga56">01064</a> <span class="preprocessor">#define PA_GetSpritePrio(screen, obj) ((PA_obj[screen][obj].atr2 &amp; OBJ_PRIO) &gt;&gt; 10)</span>
01065 <span class="preprocessor"></span>
01066 
<a name="l01078"></a><a class="code" href="group___sprite.html#ga57">01078</a> <span class="preprocessor">#define PA_GetSpriteLx(screen, sprite) PA_size[PA_obj[screen][sprite].atr0 &gt;&gt; 14][PA_obj[screen][sprite].atr1 &gt;&gt; 14].lx</span>
01079 <span class="preprocessor"></span>
01080 
<a name="l01092"></a><a class="code" href="group___sprite.html#ga58">01092</a> <span class="preprocessor">#define PA_GetSpriteLy(screen, sprite)PA_size[PA_obj[screen][sprite].atr0 &gt;&gt; 14][PA_obj[screen][sprite].atr1 &gt;&gt; 14].ly</span>
01093 <span class="preprocessor"></span>
01094 
<a name="l01109"></a><a class="code" href="group___sprite.html#ga59">01109</a> <span class="preprocessor">#define PA_CloneSprite(screen, obj, target) {PA_obj[screen][obj].atr0 = PA_obj[screen][target].atr0; PA_obj[screen][obj].atr1 = PA_obj[screen][target].atr1; PA_obj[screen][obj].atr2 = PA_obj[screen][target].atr2; ++obj_per_gfx[screen][PA_GetSpriteGfx(screen, target)];}</span>
01110 <span class="preprocessor"></span>
01111 
01112 
01113 
01114 
01115 
01116 
01117 
<a name="l01141"></a><a class="code" href="group___sprite.html#ga16">01141</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga16">PA_SetSpriteAnimEx</a>(<span class="keywordtype">bool</span> screen, u8 sprite, u8 lx, u8 ly, u8 ncolors, s16 animframe){
01142        u16 gfx = <a class="code" href="group___sprite.html#ga54">PA_GetSpriteGfx</a>(screen, sprite);
01143        <span class="comment">//PA_OutputText(1, 0, PA_Rand()&amp;15, "%03d - %03d   ", gfx, sprite);</span>
01144        <a class="code" href="group___sprite.html#ga8">PA_UpdateGfx</a>(screen, gfx, (<span class="keywordtype">void</span>*)(PA_SpriteAnimP[screen][gfx] + (animframe * (lx * ly) &gt;&gt; (2 - ncolors))));
01145 }
01146 
<a name="l01161"></a><a class="code" href="group___sprite.html#ga17">01161</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga17">PA_SetSpriteAnim</a>(<span class="keywordtype">bool</span> screen, u8 sprite, s16 animframe){
01162        <a class="code" href="group___sprite.html#ga16">PA_SetSpriteAnimEx</a>(screen, sprite, <a class="code" href="group___sprite.html#ga57">PA_GetSpriteLx</a>(screen, sprite), <a class="code" href="group___sprite.html#ga58">PA_GetSpriteLy</a>(screen, sprite), <a class="code" href="group___sprite.html#ga44">PA_GetSpriteColors</a>(screen, sprite), animframe);
01163 }
01164 
01165 
01166 
01167 
01188 <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga18">PA_StartSpriteAnim</a>(<span class="keywordtype">bool</span> screen, u8 sprite, s16 firstframe, s16 lastframe, s16 speed);
01189 
01190 
01191 
<a name="l01203"></a><a class="code" href="group___sprite.html#ga19">01203</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga19">PA_StopSpriteAnim</a>(<span class="keywordtype">bool</span> screen, u8 sprite)
01204 {
01205        <span class="keywordflow">if</span> (spriteanims[screen][sprite].play) nspriteanims--;
01206        spriteanims[screen][sprite].play = 0;
01207 }
01208 
<a name="l01223"></a><a class="code" href="group___sprite.html#ga20">01223</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga20">PA_SetSpriteAnimFrame</a>(<span class="keywordtype">bool</span> screen, u8 sprite, u16 frame)
01224 {
01225        <span class="keywordflow">if</span>(spriteanims[screen][sprite].currentframe != frame){
01226               <a class="code" href="group___sprite.html#ga16">PA_SetSpriteAnimEx</a>(screen, sprite, spriteanims[screen][sprite].lx, spriteanims[screen][sprite].ly, spriteanims[screen][sprite].colors, spriteanims[screen][sprite].currentframe);
01227               spriteanims[screen][sprite].currentframe = frame;
01228        }
01229 }
01230 
01231 
<a name="l01243"></a><a class="code" href="group___sprite.html#ga21">01243</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u16 <a class="code" href="group___sprite.html#ga21">PA_GetSpriteAnimFrame</a>(<span class="keywordtype">bool</span> screen, u8 sprite)
01244 {
01245        <span class="keywordflow">return</span> spriteanims[screen][sprite].currentframe;
01246 }
01247 
01248 
01249 
<a name="l01264"></a><a class="code" href="group___sprite.html#ga22">01264</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga22">PA_SetSpriteAnimSpeed</a>(<span class="keywordtype">bool</span> screen, u8 sprite, s16 speed)
01265 {
01266        spriteanims[screen][sprite].speed = speed;
01267 }
01268 
<a name="l01280"></a><a class="code" href="group___sprite.html#ga23">01280</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u16 <a class="code" href="group___sprite.html#ga23">PA_GetSpriteAnimSpeed</a>(<span class="keywordtype">bool</span> screen, u8 sprite)
01281 {
01282        <span class="keywordflow">return</span> spriteanims[screen][sprite].speed;
01283 }
01284 
01285 
01286 
01287 
01288 
01289 
01290 
01291 
01292 
01293 
<a name="l01308"></a><a class="code" href="group___sprite.html#ga24">01308</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga24">PA_SpriteAnimPause</a>(<span class="keywordtype">bool</span> screen, u8 sprite, <span class="keywordtype">bool</span> pause)
01309 {
01310        <span class="keywordflow">if</span> (pause&amp;&amp;spriteanims[screen][sprite].play) nspriteanims--;
01311        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!pause)&amp;&amp;(!spriteanims[screen][sprite].play)) nspriteanims++;
01312        spriteanims[screen][sprite].play = !pause;
01313 }
01314 
01315 
01316 
01317 
01318 
01319 
<a name="l01340"></a><a class="code" href="group___sprite.html#ga25">01340</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga25">PA_SetSpritePixel</a>(<span class="keywordtype">bool</span> screen, u8 sprite, u8 x, u8 y, u8 color){
01341 u8 hsize = spriteanims[screen][sprite].lx&gt;&gt;3;
01342 
01343        s32 pos = (x &gt;&gt; 3) + ((y &gt;&gt; 3) * hsize);
01344        x&amp;=7; y&amp;=7;
01345        
01346        pos = (pos &lt;&lt; 5) + (x &gt;&gt; 1) + (y &lt;&lt; 2);
01347        
01348        u16 pixel = spriteanims[screen][sprite].gfx[pos];
01349        
01350        <span class="keywordflow">if</span> (x&amp;1){
01351               spriteanims[screen][sprite].gfx[pos] = (color &lt;&lt; 8) | (pixel&amp;0x00FF);               
01352        }
01353        <span class="keywordflow">else</span> {
01354               spriteanims[screen][sprite].gfx[pos] = color | (pixel&amp;0xFF00); 
01355        }
01356 }
01357 
01358 
<a name="l01376"></a><a class="code" href="group___sprite.html#ga26">01376</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___sprite.html#ga26">PA_GetSpritePixel</a>(<span class="keywordtype">bool</span> screen, u8 sprite, u8 x, u8 y) {
01377 u8 hsize = spriteanims[screen][sprite].lx&gt;&gt;3;
01378 
01379        s32 pos = (x &gt;&gt; 3) + ((y &gt;&gt; 3) * hsize);
01380        x&amp;=7; y&amp;=7;
01381        
01382        pos = (pos &lt;&lt; 5) + (x &gt;&gt; 1) + (y &lt;&lt; 2);
01383        
01384        u16 pixel = spriteanims[screen][sprite].gfx[pos];
01385        
01386        <span class="keywordflow">if</span> (x&amp;1){
01387               <span class="keywordflow">return</span> ((pixel&gt;&gt;8)&amp;255);                  
01388        }
01389        <span class="keywordflow">else</span> {
01390               <span class="keywordflow">return</span> (pixel&amp;255);
01391        }
01392 }
01393 
01394 
01406 <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga27">PA_InitSpriteDraw</a>(<span class="keywordtype">bool</span> screen, u8 sprite);
01407 
01408 
01409 
<a name="l01415"></a><a class="code" href="group___sprite.html#ga28">01415</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sprite.html#ga28">PA_InitAllSpriteDraw</a>(<span class="keywordtype">void</span>){
01416 u8 i, j;
01417 <span class="keywordflow">for</span> (j = 0; j &lt; 2; j++)
01418        <span class="keywordflow">for</span> (i = 0; i &lt; 128; i++)
01419               <a class="code" href="group___sprite.html#ga27">PA_InitSpriteDraw</a>(j, i);
01420 }
01421 
01422 
01423 
01424 
01425 
01426 
01427 
01428 
01429 
01430 
01431 
01432  <span class="comment">// end of Sprite</span>
01434 
01435 
01436 
01437 
01438 
01439 <span class="keywordtype">void</span> PA_UpdateSpriteAnims(<span class="keywordtype">void</span>);
01440 
01441 
01442 
01443 
01444 
01445 
01446 
01447 
01448 
01449 
01450 
01451 <span class="preprocessor">#endif</span>
01452 <span class="preprocessor"></span>
01453 
</pre></div><hr size="1"><address style="align: right;"><small>Généré le Sun Feb 5 18:34:13 2006 pour PAlib par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
