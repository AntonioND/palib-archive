<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PAlib:  Fichier source de PA_BgTiles.h</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Généré par Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Page&nbsp;principale</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">Liste&nbsp;des&nbsp;fichiers</a> | <a class="qindex" href="globals.html">Portée&nbsp;globale</a>  | <span class="search">Rechercher&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>PA_BgTiles.h</h1><a href="_p_a___bg_tiles_8h.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef _PA_BGTILES</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define _PA_BGTILES</span>
00003 <span class="preprocessor"></span>
00004 <span class="comment">//#include &lt;PA9.h&gt;</span>
00005 <span class="comment">//#include &lt;PA_FS.h&gt;</span>
00006 <span class="preprocessor">#include &lt;nds.h&gt;</span>
00007 <span class="preprocessor">#include "<a class="code" href="_p_a___general_8h.html">PA_General.h</a>"</span>
00008 
00009 
00010 <span class="preprocessor">#define BG_TILEDBG   2</span>
00011 <span class="preprocessor"></span><span class="preprocessor">#define BG_ROTBG     3</span>
00012 <span class="preprocessor"></span><span class="preprocessor">#define BG_LARGEMAP 4</span>
00013 <span class="preprocessor"></span><span class="preprocessor">#define BG_INFINITEMAP 5</span>
00014 <span class="preprocessor"></span>
00015 <span class="keywordtype">void</span> PA_EasyBgLoadEx(u8 screen, u8 bg_number, u32 *Infos, <span class="keywordtype">void</span> *Tiles, u32 TileSize, <span class="keywordtype">void</span> *Map, u32 MapSize, <span class="keywordtype">void</span> *Palette);
00016 
00017 
00018 <span class="comment">// Extracts the size from PAGfx convertions</span>
00019 <span class="keyword">extern</span> <span class="keyword">inline</span> u8 PA_GetPAGfxBgSize(u16 width, u16 height)
00020 {
00021        u8 bg_size = 0;
00022        <span class="keywordflow">if</span> (height == 512)   bg_size = 2;
00023        <span class="keywordflow">if</span> (width == 512)    bg_size ++;   
00024        <span class="keywordflow">return</span> bg_size;
00025 }
00026 
00027 <span class="comment">// Extracts the size from PAGfx convertions</span>
00028 <span class="keyword">extern</span> <span class="keyword">inline</span> u8 PA_GetPAGfxRotBgSize(u16 width)
00029 {
00030        u8 bg_size = 1; <span class="comment">//256x256 by default</span>
00031        <span class="keywordflow">if</span> (width &lt;= 128)    bg_size = 0;  
00032        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (width &lt;= 256)      bg_size = 1;  
00033        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (width &lt;= 512)      bg_size = 2;         
00034        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (width &lt;= 1024) bg_size = 3;             
00035        
00036        <span class="keywordflow">return</span> bg_size;
00037 }
00038 
00039 
00040 <span class="keyword">typedef</span> u8 (*EasyBgPixels)(u8, u8, s32, s32);  
00041 
00042 <span class="keyword">extern</span> EasyBgPixels PA_EasyBgPixel[6];
00043 
00053 
00054 <span class="comment">// Système de Tiles</span>
00056 <span class="comment"></span>
00057 
00058 <span class="comment">//background memory offset macros</span>
00059 <span class="preprocessor">#define CharBaseBlock(screen, n) (((n)*0x4000) + 0x6000000 + (0x200000 *  screen))</span>
00060 <span class="preprocessor"></span><span class="preprocessor">#define ScreenBaseBlock(screen, n) (((n)*0x800) + 0x6000000 + (0x200000 *  screen))</span>
00061 <span class="preprocessor"></span>
00062 <span class="comment">// Pointers towards background arrays</span>
00063 <span class="keyword">typedef</span> <span class="keyword">struct</span>{
00064        <span class="keywordtype">void</span> *Tiles;
00065        <span class="keywordtype">void</span> *Map;
00066        <span class="keywordtype">void</span> *Palette;
00067        u32 TileSize, MapSize;
00068        u32 Type, Width, Height; 
00069 } PA_BgDefaultInfos;
00070        
00071 
00072 <span class="keyword">typedef</span> <span class="keyword">struct</span>{
00073        <span class="comment">// Memory management info...</span>
00074 
00075 
00076        u32 tilesetsize; <span class="comment">// Place utilisée pour chaque tileset</span>
00077        u16 mapsize; <span class="comment">// Place utilisée pour chaque map</span>
00078 <span class="comment">//extern u8 tilesetchar[2][4];  // Emplacement mémoire de chaque tileset</span>
00079        u8 mapchar;  <span class="comment">// Emplacement mémoire de chaque map</span>
00080 
00081 
00082        u32 Map; <span class="comment">// Map pointer</span>
00083        u8 TileSetChar;
00084        
00085        u32 NTiles;
00086        u32 *TilePos;
00087        <span class="keywordtype">void</span> *Tiles;  
00088        
00089        PA_BgDefaultInfos Infos; <span class="comment">// Pointers towards background arrays</span>
00090        
00091        s32 ScrollX, ScrollY; <span class="comment">// Scroll values</span>
00092        
00093        u8 BgMode; <span class="comment">// Background mode</span>
00094 } PA_BgInfos;
00095 <span class="keyword">extern</span> PA_BgInfos PA_BgInfo[2][4];
00096 
00097 <span class="keyword">extern</span> u8 charblocks[2][70];
00098 <span class="comment">//extern u32 PA_bgmap[2][4]; // Pointeur vers les maps, 4 maps par screen</span>
00099 <span class="comment">//extern u8 tilesetchar[2][4];</span>
00100 
00101 <span class="comment">// Quantité de données à charger en fonction de la taille de la map...</span>
00102 
00103 <span class="keyword">extern</span> u16 *PA_DrawBg[2]; <span class="comment">// Fond dessinable</span>
00104 
00105 <span class="keyword">extern</span> u16 bg_sizes[4];
00106 <span class="keyword">extern</span> u8 bg_place[4];
00107 
00108 
00109 <span class="keyword">extern</span> u8 charsetstart[2];
00110 <span class="keyword">extern</span> s32 PA_parallaxX[2][4];
00111 <span class="keyword">extern</span> s32 PA_parallaxY[2][4];
00112 
00113 
00114 
00115 
00116 
00117 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00118        u8 infscroll; <span class="comment">// Passe à 1 si scrolling infini activé...</span>
00119        u16* bg_map; <span class="comment">// Map</span>
00120 <span class="comment">//     s32 x, y;</span>
00121        s32 lx, ly;
00122        s32 scrollx, scrolly;
00123        s32 maxx; <span class="comment">// 32 ou 64, en fonction de la largeur...</span>
00124 <span class="comment">//     s32 startx, starty;</span>
00125 }scrollpositions;
00126 
00127 <span class="keyword">extern</span> scrollpositions scrollpos[2][4]; <span class="comment">// Pour chaque écran et pour chaque fond :)</span>
00128 
00129 
00130 
00131 
00132 
00133 
00134 <span class="comment">// Mode de couleur</span>
00135 <span class="preprocessor">#define BG_COLOR16 0x00</span>
00136 <span class="preprocessor"></span><span class="preprocessor">#define BG_COLOR256 0x80</span>
00137 <span class="preprocessor"></span>
00138 
00139 <span class="preprocessor">#define CHAR_SHIFT 2</span>
00140 <span class="preprocessor"></span><span class="preprocessor">#define SCREEN_SHIFT 8</span>
00141 <span class="preprocessor"></span><span class="preprocessor">#define WRAPAROUND 0x1</span>
00142 <span class="preprocessor"></span>
00143 <span class="preprocessor">#define SCREEN_TILES 24576  // Taille à convertir pour avoir un écran complet...</span>
00144 <span class="preprocessor"></span>
00145 
00146 <span class="comment">//scrolling registers for background 0</span>
00147 
00148 
00149 <span class="comment">// Registre pour les controles de chaque écran</span>
00150 
00151 <span class="preprocessor">#define REG_BGSCREEN0  0x04000000</span>
00152 <span class="preprocessor"></span><span class="preprocessor">#define REG_BGSCREEN1  0x04001000</span>
00153 <span class="preprocessor"></span><span class="preprocessor">#define REG_BGSCREEN(screen) (0x04000000 + (screen * 0x1000))</span>
00154 <span class="preprocessor"></span>
00155 <span class="preprocessor">#define REG_BGCNT(screen, bg_number) (0x4000008 + (screen * 0x1000) + (bg_number &lt;&lt; 1))</span>
00156 <span class="preprocessor"></span>
00157 <span class="comment">// Premier registre pour les scroll. On en déduit les autres en ajoutant pour le screen et le numéro du Bg</span>
00158 <span class="preprocessor">#define REG_BGSCROLLX 0x4000010</span>
00159 <span class="preprocessor"></span><span class="preprocessor">#define REG_BGSCROLLY 0x4000012</span>
00160 <span class="preprocessor"></span>
00161 
00162 <span class="comment">// Tailles pour les Bg :</span>
00163 <span class="preprocessor">#define BG_256X256 0</span>
00164 <span class="preprocessor"></span><span class="preprocessor">#define BG_512X256 1</span>
00165 <span class="preprocessor"></span><span class="preprocessor">#define BG_256X512 2</span>
00166 <span class="preprocessor"></span><span class="preprocessor">#define BG_512X512 3</span>
00167 <span class="preprocessor"></span>
00168 
00169 
00170 <span class="comment">//ALL_BUT() pour faire tout sauf...</span>
00171 <span class="preprocessor">#define TILE_N 1023</span>
00172 <span class="preprocessor"></span><span class="preprocessor">#define TILE_PAL 61440</span>
00173 <span class="preprocessor"></span><span class="preprocessor">#define TILE_HFLIP 1024</span>
00174 <span class="preprocessor"></span><span class="preprocessor">#define TILE_VFLIP 2048</span>
00175 <span class="preprocessor"></span>
00176 
00177 
00178 
00179 
00191 <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga0">PA_ResetBgSys</a>(<span class="keywordtype">void</span>);
00192 
00193 
00203 <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga1">PA_ResetBgSysScreen</a>(u8 screen);
00204 
00227 <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga2">PA_InitBg</a>(u8 screen, u8 bg_select, u8 bg_size, u8 wraparound, u8 color_mode);
00228 <span class="comment">//#define PA_InitBg(screen, bg_select, bg_size, wraparound, color_mode) {    PA_bgmap[screen][bg_select] = ScreenBaseBlock(screen, ((bg_select + 1) &lt;&lt; 3) - bg_place[bg_size]);_REG16(REG_BGSCREEN(screen)) |= (0x100 &lt;&lt; (bg_select)); _REG16(REG_BGCNT(screen, bg_select)) = ((bg_select) | (bg_size &lt;&lt; 14) |((((bg_select + 1) &lt;&lt; 3) - bg_place[bg_size]) &lt;&lt; SCREEN_SHIFT) | (wraparound &lt;&lt; 13) | ((bg_select) &lt;&lt; 2)) + (color_mode &lt;&lt; 7);}</span>
00229 
00230 
<a name="l00243"></a><a class="code" href="group___bg_tiles.html#ga24">00243</a> <span class="preprocessor">#define PA_HideBg(screen, bg_select) _REG16(REG_BGSCREEN(screen)) &amp;= ~(0x100 &lt;&lt; (bg_select))</span>
00244 <span class="preprocessor"></span>
00245 
<a name="l00258"></a><a class="code" href="group___bg_tiles.html#ga25">00258</a> <span class="preprocessor">#define PA_ShowBg(screen, bg_select) _REG16(REG_BGSCREEN(screen)) |= (0x100 &lt;&lt; (bg_select))</span>
00259 <span class="preprocessor"></span>
00260 
<a name="l00270"></a><a class="code" href="group___bg_tiles.html#ga26">00270</a> <span class="preprocessor">#define PA_ResetBg(screen) _REG16(REG_BGSCREEN(screen)) &amp;= ~(0xF00)</span>
00271 <span class="preprocessor"></span>
00272 
00273 
<a name="l00289"></a><a class="code" href="group___bg_tiles.html#ga27">00289</a> <span class="preprocessor">#define PA_LoadBgTiles(screen, bg_select, bg_tiles) PA_LoadBgTilesEx(screen, bg_select, (void*)bg_tiles, SIZEOF_16BIT(bg_tiles))</span>
00290 <span class="preprocessor"></span><span class="comment">//#define PA_LoadBgTiles(screen, bg_select, bg_tiles) {DMA_Copy((void*)(bg_tiles), (void*)CharBaseBlock(screen, bg_select),SIZEOF_16BIT(bg_tiles), DMA_16NOW);}</span>
00291 
00292 
00312 <span class="keywordtype">void</span> PA_LoadBgTilesEx(u8 screen, u8 bg_select, <span class="keywordtype">void</span>* bg_tiles, u32 size);
00313 
00314 
00330 <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga4">PA_ReLoadBgTiles</a>(u8 screen, u8 bg_select, <span class="keywordtype">void</span>* bg_tiles);
00331 
00332 
00345 <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga5">PA_DeleteTiles</a>(u8 screen, u8 bg_select);
00346 
00347 
00360 <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga6">PA_DeleteMap</a>(u8 screen, u8 bg_select);
00361 
00362 
00363 
<a name="l00376"></a><a class="code" href="group___bg_tiles.html#ga7">00376</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga7">PA_DeleteBg</a>(u8 screen, u8 bg_select) {
00377        <a class="code" href="group___bg_tiles.html#ga24">PA_HideBg</a>(screen, bg_select);
00378        <a class="code" href="group___bg_tiles.html#ga5">PA_DeleteTiles</a>(screen, bg_select);
00379        <a class="code" href="group___bg_tiles.html#ga6">PA_DeleteMap</a>(screen, bg_select);
00380 }
00381 
00401 <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga8">PA_LoadBgMap</a>(u8 screen, u8 bg_select, <span class="keywordtype">void</span>* bg_map, u8 bg_size);
00402 
00403 
00404 
00405 
00406 
<a name="l00423"></a><a class="code" href="group___bg_tiles.html#ga28">00423</a> <span class="preprocessor">#define PA_LoadTiledBg(screen, bg_number, bg_name){\</span>
00424 <span class="preprocessor">       PA_LoadBgPal(screen, bg_number, (void*)bg_name##_Pal); \</span>
00425 <span class="preprocessor">       PA_LoadSimpleBg(screen, bg_number, bg_name##_Tiles, bg_name##_Map, PA_GetPAGfxBgSize(bg_name##_Info[1], bg_name##_Info[2]), 0, 1);}</span>
00426 <span class="preprocessor"></span>
00427 
00428 
00429 
<a name="l00458"></a><a class="code" href="group___bg_tiles.html#ga29">00458</a> <span class="preprocessor">#define PA_LoadSimpleBg(screen, bg_select, bg_tiles, bg_map, bg_size, wraparound, color_mode) {\</span>
00459 <span class="preprocessor">PA_DeleteBg(screen, bg_select);\</span>
00460 <span class="preprocessor">PA_LoadBgTiles(screen, bg_select, bg_tiles); \</span>
00461 <span class="preprocessor">PA_LoadBgMap(screen, bg_select, (void*)bg_map, bg_size); \</span>
00462 <span class="preprocessor">PA_InitBg(screen, bg_select, bg_size, 0, color_mode);\</span>
00463 <span class="preprocessor">PA_BGScrollXY(screen, bg_select, 0, 0);}</span>
00464 <span class="preprocessor"></span>
00465 
00466 
00467 
<a name="l00499"></a><a class="code" href="group___bg_tiles.html#ga30">00499</a> <span class="preprocessor">#define PA_LoadBg(screen, bg_select, bg_tiles, tile_size, bg_map, bg_size, wraparound, color_mode) {\</span>
00500 <span class="preprocessor">PA_LoadBgTilesEx(screen, bg_select, (void*)bg_tiles, tile_size); \</span>
00501 <span class="preprocessor">PA_LoadBgMap(screen, bg_select, (void*)bg_map, bg_size); \</span>
00502 <span class="preprocessor">PA_InitBg(screen, bg_select, bg_size, 0, color_mode);\</span>
00503 <span class="preprocessor">PA_BGScrollXY(screen, bg_select, 0, 0);}</span>
00504 <span class="preprocessor"></span>
00505 
00506 
<a name="l00522"></a><a class="code" href="group___bg_tiles.html#ga9">00522</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga9">PA_BGScrollX</a>(u8 screen, u8 bg_number, s32 x) {
00523        PA_BgInfo[screen][bg_number].ScrollX = (x)&amp;1023;
00524        _REG16(REG_BGSCROLLX + ((screen) * 0x1000) + ((bg_number) &lt;&lt; 2)) = (x)&amp;1023;
00525 }      
00526 
<a name="l00542"></a><a class="code" href="group___bg_tiles.html#ga10">00542</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga10">PA_BGScrollY</a>(u8 screen, u8 bg_number, s32 y) {
00543        PA_BgInfo[screen][bg_number].ScrollY = (y)&amp;1023;
00544        _REG16(REG_BGSCROLLY + ((screen) * 0x1000) + ((bg_number) &lt;&lt; 2)) = (y)&amp;1023;
00545 }      
00546 
00547 
00548 
00567 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> PA_BGScrollXY(u8 screen, u8 bg_number, s32 x, s32 y) {
00568        <a class="code" href="group___bg_tiles.html#ga9">PA_BGScrollX</a>(screen, bg_number, x); 
00569        <a class="code" href="group___bg_tiles.html#ga10">PA_BGScrollY</a>(screen, bg_number, y);
00570 }
00571 
00572 
00573 
00574 
<a name="l00596"></a><a class="code" href="group___bg_tiles.html#ga12">00596</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga12">PA_SetMapTile</a>(u8 screen, u8 bg_select, s16 x, s16 y, s16 tile_number) {
00597 *(u16*)(PA_BgInfo[screen][bg_select].Map + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) &amp;= ~(TILE_N); 
00598 *(u16*)(PA_BgInfo[screen][bg_select].Map + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) |= ((tile_number)&amp;TILE_N);
00599 }
00600 
00601 
<a name="l00623"></a><a class="code" href="group___bg_tiles.html#ga31">00623</a> <span class="preprocessor">#define PA_SetMapTileAll(screen, bg_select, x, y, tile_info) *(u16*)(PA_BgInfo[screen][bg_select].Map + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) = (tile_info)</span>
00624 <span class="preprocessor"></span>
00625 
00626 
00627 
00628 
<a name="l00650"></a><a class="code" href="group___bg_tiles.html#ga13">00650</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga13">PA_SetLargeMapTile</a>(u8 screen, u8 bg_select, s32 x, s32 y, u32 tile_info) {
00651        u32 truex;
00652        u32 mapblock = 0;
00653        truex = x&amp;31;
00654        mapblock = ((x &gt;&gt; 5) &lt;&lt; 11) + ((y &gt;&gt; 5) &lt;&lt; 12); <span class="comment">// Permet d'avoir le bon block...</span>
00655        
00656        *(u16*)(PA_BgInfo[screen][bg_select].Map + ((truex) &lt;&lt; 1) + ((y&amp;31) &lt;&lt; 6) + mapblock) = tile_info;
00657 }
00658 
00659 
00660 
<a name="l00682"></a><a class="code" href="group___bg_tiles.html#ga32">00682</a> <span class="preprocessor">#define PA_SetMapTileHflip(screen, bg_select, x, y, hflip) {*(u16*)(PA_bgmap[screen][bg_select] + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) &amp;= ALL_BUT(TILE_HFLIP); *(u16*)(PA_bgmap[screen][bg_select] + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) |= ((hflip) &lt;&lt; 10);}</span>
00683 <span class="preprocessor"></span>
00684 
<a name="l00706"></a><a class="code" href="group___bg_tiles.html#ga33">00706</a> <span class="preprocessor">#define PA_SetMapTileVflip(screen, bg_select, x, y, vflip) {*(u16*)(PA_bgmap[screen][bg_select] + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) &amp;= ALL_BUT(TILE_VFLIP); *(u16*)(PA_bgmap[screen][bg_select] + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) |= ((vflip) &lt;&lt; 11);}</span>
00707 <span class="preprocessor"></span>
00708 
<a name="l00730"></a><a class="code" href="group___bg_tiles.html#ga34">00730</a> <span class="preprocessor">#define PA_SetMapTilePal(screen, bg_select, x, y, palette_number) {*(u16*)(PA_BgInfo[screen][bg_select].Map + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) &amp;= ALL_BUT(TILE_PAL); *(u16*)(PA_BgInfo[screen][bg_select].Map + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) |= ((palette_number) &lt;&lt; 12);}</span>
00731 <span class="preprocessor"></span>
00732 
00763 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> PA_SetMapTileEx(u8 screen, u8 bg_select, s16 x, s16 y, u16 tile_number, u8 hflip, u8 vflip, u8 palette_number) {
00764        *(u16*)(PA_BgInfo[screen][bg_select].Map + ((x) &lt;&lt; 1) + ((y) &lt;&lt; 6)) = (tile_number) + ((hflip) &lt;&lt; 10) + ((vflip) &lt;&lt; 11) + ((palette_number) &lt;&lt; 12);
00765 }
00766 
00767 
00768 
00769 
00770 
00771 
00772 
00773 
00774 
00775 
<a name="l00791"></a><a class="code" href="group___bg_tiles.html#ga15">00791</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga15">PA_SetBgPrio</a>(u8 screen, u8 bg, u8 prio) {
00792        _REG16(REG_BGCNT(screen, bg)) &amp;= ~3;
00793        _REG16(REG_BGCNT(screen, bg)) |= prio;
00794 }
00795 
00796 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> PA_CreateBgFromTiles(u8 screen, u8 bg_select, u8 bg_tiles, <span class="keywordtype">void</span> *bg_map, u8 bg_size){
00797 <a class="code" href="group___bg_tiles.html#ga8">PA_LoadBgMap</a>(screen, bg_select, bg_map, bg_size);
00798 scrollpos[screen][bg_select].infscroll = 0; <span class="comment">// Par défaut pas de scrolling infini...</span>
00799 PA_BgInfo[screen][bg_select].Map = ScreenBaseBlock(screen, PA_BgInfo[screen][bg_select].mapchar);
00800 PA_BgInfo[screen][bg_select].TileSetChar = PA_BgInfo[screen][bg_tiles].TileSetChar;
00801 PA_BgInfo[screen][bg_select].tilesetsize = PA_BgInfo[screen][bg_tiles].tilesetsize;
00802 
00803 _REG16(REG_BGSCREEN(screen)) |= (0x100 &lt;&lt; (bg_select));
00804 _REG16(REG_BGCNT(screen, bg_select)) = bg_select | (bg_size &lt;&lt; 14) |(PA_BgInfo[screen][bg_select].mapchar &lt;&lt; SCREEN_SHIFT) | (1 &lt;&lt; 13) | (PA_BgInfo[screen][bg_select].TileSetChar &lt;&lt; 2) | (1 &lt;&lt; 7);
00805 PA_BGScrollXY(screen, bg_select, 0, 0);   
00806 }
00807 
00808 
00809 
00832 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> PA_SetBgPrioSeq(u8 screen, u8  priority0, u8  priority1, u8  priority2, u8  priority3)
00833 {
00834    <a class="code" href="group___bg_tiles.html#ga15">PA_SetBgPrio</a>(screen, priority0, 0);
00835    <a class="code" href="group___bg_tiles.html#ga15">PA_SetBgPrio</a>(screen, priority1, 1);
00836    <a class="code" href="group___bg_tiles.html#ga15">PA_SetBgPrio</a>(screen, priority2, 2);
00837    <a class="code" href="group___bg_tiles.html#ga15">PA_SetBgPrio</a>(screen, priority3, 3);
00838 } 
00839 
00840 
00841 
00842 
<a name="l00854"></a><a class="code" href="group___bg_tiles.html#ga18">00854</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga18">PA_ClearBg</a>(u8 screen, u8 bg_select){
00855 u8 i, j;
00856 <span class="keywordflow">for</span> (i = 0; i &lt; 32; i++) <span class="keywordflow">for</span> (j = 0; j &lt; 32; j++) <a class="code" href="group___bg_tiles.html#ga31">PA_SetMapTileAll</a>(screen, bg_select, i, j, 0);
00857 }
00858 
00859 
00860 
00861 
00862 
<a name="l00877"></a><a class="code" href="group___bg_tiles.html#ga35">00877</a> <span class="preprocessor">#define PA_EasyBgLoad(screen, bg_number, bg_name)       PA_BgInfo[screen][bg_number].BgMode = bg_name##_Info[0];\</span>
00878 <span class="preprocessor">       PA_StoreEasyBgInfos(screen, bg_number, bg_name##_Info[0], bg_name##_Info[1], bg_name##_Info[2], (void*)bg_name##_Tiles, SIZEOF_16BIT(bg_name##_Tiles), (void*)bg_name##_Map, SIZEOF_16BIT(bg_name##_Map), (void*)bg_name##_Pal);\</span>
00879 <span class="preprocessor">       if(PA_BgInfo[screen][bg_number].BgMode == BG_TILEDBG){  PA_LoadTiledBg(screen, bg_number, bg_name);}\</span>
00880 <span class="preprocessor">       else{PA_LoadPAGfxLargeBg(screen, bg_number, bg_name);}</span>
00881 <span class="preprocessor"></span>
00882 <span class="comment">/*PA_EasyBgLoadEx(screen, bg_number, (u32*)bg_name##_Info, (void*)bg_name##_Tiles, SIZEOF_16BIT(bg_name##_Tiles), (void*)bg_name##_Map, SIZEOF_16BIT(bg_name##_Map), (void*)bg_name##_Pal)*/</span>
00883 
00884 
00885 
00901 <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga19">PA_EasyBgScrollX</a>(u8 screen, u8 bg_number, s32 x);
00902 
00903 
00904 
00920 <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga20">PA_EasyBgScrollY</a>(u8 screen, u8 bg_number, s32 y);
00921 
00922 
<a name="l00941"></a><a class="code" href="group___bg_tiles.html#ga21">00941</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___bg_tiles.html#ga21">PA_EasyBgScrollXY</a>(u8 screen, u8 bg_number, s32 x, s32 y){
00942        <a class="code" href="group___bg_tiles.html#ga19">PA_EasyBgScrollX</a>(screen, bg_number, x);
00943        <a class="code" href="group___bg_tiles.html#ga20">PA_EasyBgScrollY</a>(screen, bg_number, y);
00944 }
00945 
00946 
<a name="l00965"></a><a class="code" href="group___bg_tiles.html#ga22">00965</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___bg_tiles.html#ga22">PA_EasyBgGetPixel</a>(u8 screen, u8 bg_number, s32 x, s32 y){
00966        <span class="keywordflow">return</span> PA_EasyBgPixel[PA_BgInfo[screen][bg_number].Infos.Type](screen, bg_number, x, y);
00967 }
00968 
00969 
<a name="l00988"></a><a class="code" href="group___bg_tiles.html#ga23">00988</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u16 <a class="code" href="group___bg_tiles.html#ga23">PA_EasyBgGetPixelCol</a>(u8 screen, u8 bg_number, s32 x, s32 y){
00989        <span class="keywordflow">return</span> ((u16*)(PA_BgInfo[screen][bg_number].Infos.Palette))[<a class="code" href="group___bg_tiles.html#ga22">PA_EasyBgGetPixel</a>(screen, bg_number, x, y)];
00990 }
00991 
00992 
00993 
00994  <span class="comment">// end of BgTiles</span>
00996 
00997 
00998 <span class="comment">/*</span>
00999 <span class="comment"></span>
01000 <span class="comment">void PA_StoreEasyBgInfos(u8 screen, u8 bg_number, u32 *Infos, void *Tiles, u32 TileSize, void *Map, u32 MapSize, void *Palette);</span>
01001 <span class="comment">       </span>
01002 <span class="comment">*/</span>
01003 
01004 
01005 <span class="comment">// Get pixel functions</span>
01006 
01007 u8 PAEasyBgGetPixelTiled(u8 screen, u8 bg_number, s32 x, s32 y);
01008 
01009 u8 PAEasyBgGetPixelLarge(u8 screen, u8 bg_number, s32 x, s32 y);
01010 
01011 u8 PAEasyBgGetPixelInf(u8 screen, u8 bg_number, s32 x, s32 y);
01012 
01013 u8 PANoPixel(u8 screen, u8 bg_number, s32 x, s32 y);
01014 
01015 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> PA_UpdateBgTile(u8 screen, u8 bg_select, u16 tilepos, <span class="keywordtype">void</span> *tile){
01016 tilepos = tilepos &lt;&lt; 4;
01017 u32 *tilecopy = (u32*)tile;
01018 u8 i;
01019        <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++)
01020               PA_BgInfo[screen][bg_select].TilePos[tilepos+i] = tilecopy[i];
01021 }
01022 
01023 <span class="keywordtype">void</span> PA_StoreEasyBgInfos(u8 screen, u8 bg_number, u32 Type, u32 Width, u32 Height, <span class="keywordtype">void</span> *Tiles, u32 TileSize, <span class="keywordtype">void</span> *Map, u32 MapSize, <span class="keywordtype">void</span> *Palette);
01024 
01025 
01026 <span class="preprocessor">#endif</span>
01027 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Généré le Tue Jan 30 23:10:49 2007 pour PAlib par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
