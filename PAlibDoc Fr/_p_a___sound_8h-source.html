<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PAlib:  Fichier source de PA_Sound.h</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Généré par Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Page&nbsp;principale</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">Liste&nbsp;des&nbsp;fichiers</a> | <a class="qindex" href="globals.html">Portée&nbsp;globale</a>  | <span class="search">Rechercher&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>PA_Sound.h</h1><a href="_p_a___sound_8h.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef _PA_Sound9</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define _PA_Sound9</span>
00003 <span class="preprocessor"></span>
00004 
00005 
00013 <span class="preprocessor">#include "../Sound9.h"</span>
00014 <span class="preprocessor">#include "<a class="code" href="_p_a___g_b_f_s_8h.html">PA_GBFS.h</a>"</span>
00015 <span class="preprocessor">#include "<a class="code" href="_p_a___f_s_8h.html">PA_FS.h</a>"</span>
00016 <span class="preprocessor">#include &lt;PA9.h&gt;</span>
00017 
00018        <span class="comment">// 256KB to load MOD files into. Actual size necessary is the size </span>
00019        <span class="comment">// of your largest MOD file (probably less than 256KB).</span>
00020 <span class="preprocessor">#define SND_MEM_POOL_SIZE   256*1024</span>
00021 <span class="preprocessor"></span>
00022 
00023 
00024 <span class="keyword">extern</span> TransferSound snd;
00025 <span class="keyword">extern</span> u32 *sndMemPool;
00026 
00027 <span class="keyword">typedef</span> <span class="keyword">struct</span>{ <span class="comment">// Default sound format</span>
00028        u8 volume;
00029        s16 freq;
00030        s16 format;
00031 } PA_SoundOptions;
00032 
00033 <span class="keyword">extern</span> PA_SoundOptions PA_SoundOption;
00034 
00035 <span class="keyword">extern</span> u32 *FS_mod;
00036 <span class="keyword">extern</span> u32 *FS_wav[16]; <span class="comment">// 16 channels...</span>
00037 
00038 
00039 
00040 <span class="comment">//Stream vars</span>
00041 <span class="keyword">extern</span> u32 *Stream_Gap[16];
00042 <span class="keyword">extern</span> u32 *Stream_End[16];
00043 <span class="keyword">extern</span> u32 *Stream_Datas[16]; 
00044 <span class="keyword">extern</span> u32 *Stream_Regen_Ptr[16];
00045 <span class="keyword">extern</span> s64    Stream_Length[16];
00046 <span class="keyword">extern</span> u32    Stream_Last_Tick[16];
00047 <span class="keyword">extern</span> s32    Stream_Repeat[16];
00048 <span class="keyword">extern</span> u8     Stream_Timer[16];
00049 
00050 <span class="comment">//plays an 8 bit mono sample at 11025Hz</span>
00051 
00052 
00053 
00054 
00055 
00056 
00077 <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga0">PA_SetDefaultSound</a>(u8 volume, <span class="keywordtype">int</span> freq, s16 format);
00078 
00079 
<a name="l00085"></a><a class="code" href="group___sound_a_r_m9.html#ga1">00085</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga1">PA_InitSound</a>(<span class="keywordtype">void</span>) {
00086        SndInit9 ();
00087        sndMemPool = (u32*)0x2200000;
00088        SndSetMemPool(sndMemPool, SND_MEM_POOL_SIZE);
00089        <a class="code" href="group___sound_a_r_m9.html#ga0">PA_SetDefaultSound</a>(127, 11025, 0);
00090        FS_mod = NULL; <span class="comment">// Initialise a small portion of memory, will make it bigger later on...</span>
00091        u8 i;
00092        <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++)
00093        {
00094               FS_wav[i] = NULL; <span class="comment">// to be able to free</span>
00095        }
00096 
00097 }
00098 
00099 
00100 
00106 <span class="keyword">extern</span> <span class="keywordtype">void</span> PA_InitStreamSound(<span class="keywordtype">void</span>);
00107 
00113 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga3">PA_RegenStream</a>(<span class="keywordtype">void</span>);
00114 
00120 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga4">FillTheGap</a>(u8 PA_Channel, u32 size);
00121 
00151 <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga5">PA_PlaySoundEx2</a>(u8 PA_Channel, <span class="keyword">const</span> <span class="keywordtype">void</span>* data, s32 length, u8 volume, <span class="keywordtype">int</span> freq, s16 format, BOOL repeat, <span class="keywordtype">int</span> repeatPoint);
00152 
<a name="l00176"></a><a class="code" href="group___sound_a_r_m9.html#ga6">00176</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga6">PA_PlaySoundEx</a>(u8 PA_Channel, <span class="keyword">const</span> <span class="keywordtype">void</span>* data, s32 length, u8 volume, <span class="keywordtype">int</span> freq, s16 format){
00177 <a class="code" href="group___sound_a_r_m9.html#ga5">PA_PlaySoundEx2</a>(PA_Channel, data, length, volume, freq, format,<span class="keyword">false</span>,0);
00178 }
00179 
<a name="l00200"></a><a class="code" href="group___sound_a_r_m9.html#ga7">00200</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga7">PA_PlayGBFSSoundEx</a>(u8 PA_Channel, u16 FS_wav_number, u8 volume, <span class="keywordtype">int</span> freq, s16 format){
00201 s32 length = (PA_GBFSfile[FS_wav_number].Length &gt;&gt; 2) + 1; <span class="comment">// Pour etre sur...</span>
00202        free(FS_wav[PA_Channel]);
00203        FS_wav[PA_Channel] = (u32*)malloc(length &lt;&lt; 2);
00204        
00205        DMA_Copy(PA_GBFSfile[FS_wav_number].File, FS_wav[PA_Channel], length, DMA_32NOW);
00206 
00207        <a class="code" href="group___sound_a_r_m9.html#ga6">PA_PlaySoundEx</a>(PA_Channel, (<span class="keywordtype">void</span>*)FS_wav[PA_Channel], length &lt;&lt; 2, volume, freq, format);
00208 }
00209 
<a name="l00236"></a><a class="code" href="group___sound_a_r_m9.html#ga8">00236</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga8">PA_PlayGBFSSoundEx2</a>(u8 PA_Channel, u16 FS_wav_number, u8 volume, <span class="keywordtype">int</span> freq, s16 format, BOOL repeat, <span class="keywordtype">int</span> repeatPoint){
00237 s32 length = (PA_GBFSfile[FS_wav_number].Length &gt;&gt; 2) + 1; <span class="comment">// Pour etre sur...</span>
00238        free(FS_wav[PA_Channel]);
00239        FS_wav[PA_Channel] = (u32*)malloc(length &lt;&lt; 2);
00240        
00241        DMA_Copy(PA_GBFSfile[FS_wav_number].File, FS_wav[PA_Channel], length, DMA_32NOW);
00242 
00243        <a class="code" href="group___sound_a_r_m9.html#ga5">PA_PlaySoundEx2</a>(PA_Channel, (<span class="keywordtype">void</span>*)FS_wav[PA_Channel], length &lt;&lt; 2, volume, freq, format, repeat, repeatPoint);
00244 
00245 }
00246 
00247 
<a name="l00268"></a><a class="code" href="group___sound_a_r_m9.html#ga9">00268</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga9">PA_PlayFSSoundEx</a>(u8 PA_Channel, u16 PAFS_wav_number, u8 volume, <span class="keywordtype">int</span> freq, s16 format){
00269        <a class="code" href="group___p_a_f_s.html#ga4">PA_Malloc</a>((<span class="keywordtype">void</span>**)FS_wav[PA_Channel], PA_FSFile[PAFS_wav_number].Length+4);
00270 
00271        s32 i;
00272        s32 length = (PA_FSFile[PAFS_wav_number].Length&gt;&gt;2) + 1; <span class="comment">// Pour etre sur...</span>
00273        <span class="keywordflow">for</span> (i = 0; i &lt; length; i++) FS_wav[PA_Channel][i] = ((u32*)<a class="code" href="group___p_a_f_s.html#ga5">PA_PAFSFile</a>(PAFS_wav_number))[i];
00274        
00275        <a class="code" href="group___sound_a_r_m9.html#ga6">PA_PlaySoundEx</a>(PA_Channel, (<span class="keywordtype">void</span>*)FS_wav[PA_Channel], length &lt;&lt; 2, volume, freq, format);
00276 }
00277 
<a name="l00304"></a><a class="code" href="group___sound_a_r_m9.html#ga10">00304</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga10">PA_PlayFSSoundEx2</a>(u8 PA_Channel, u16 PAFS_wav_number, u8 volume, <span class="keywordtype">int</span> freq, s16 format, BOOL repeat, <span class="keywordtype">int</span> repeatPoint){
00305        <a class="code" href="group___p_a_f_s.html#ga4">PA_Malloc</a>((<span class="keywordtype">void</span>**)FS_wav[PA_Channel], PA_FSFile[PAFS_wav_number].Length+4);
00306 
00307        s32 i;
00308        s32 length = (PA_FSFile[PAFS_wav_number].Length&gt;&gt;2) + 1; <span class="comment">// Pour etre sur...</span>
00309        <span class="keywordflow">for</span> (i = 0; i &lt; length; i++) FS_wav[PA_Channel][i] = ((u32*)<a class="code" href="group___p_a_f_s.html#ga5">PA_PAFSFile</a>(PAFS_wav_number))[i];
00310        
00311        <a class="code" href="group___sound_a_r_m9.html#ga5">PA_PlaySoundEx2</a>(PA_Channel, (<span class="keywordtype">void</span>*)FS_wav[PA_Channel], length &lt;&lt; 2, volume, freq, format, repeat, repeatPoint);
00312 }
00313 
00341 <span class="keyword">extern</span> <span class="keywordtype">void</span> PA_StopSound(u8 PA_Channel);
00342 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga12">PA_PlayFSStreamSoundEx2</a>(u8 PA_Channel, u16 PAFS_wav_number, u8 volume, <span class="keywordtype">int</span> freq, s16 format, BOOL repeat, <span class="keywordtype">int</span> repeatPoint);
00343 
<a name="l00364"></a><a class="code" href="group___sound_a_r_m9.html#ga13">00364</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga13">PA_PlaySound</a>(u8 PA_Channel, <span class="keyword">const</span> <span class="keywordtype">void</span>* data, s32 length, u8 volume, u32 freq){
00365 <a class="code" href="group___sound_a_r_m9.html#ga5">PA_PlaySoundEx2</a>(PA_Channel, data, length, volume, freq, 1,<span class="keyword">false</span>,0);
00366 }
00367 
<a name="l00385"></a><a class="code" href="group___sound_a_r_m9.html#ga14">00385</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga14">PA_PlayGBFSSound</a>(u8 PA_Channel, u16 FS_wav_number, u8 volume, u32 freq){
00386 s32 length = (PA_GBFSfile[FS_wav_number].Length &gt;&gt; 2) + 1; <span class="comment">// Pour etre sur...</span>
00387        free(FS_wav[PA_Channel]);
00388        FS_wav[PA_Channel] = (u32*)malloc(length &lt;&lt; 2);
00389        
00390        DMA_Copy(PA_GBFSfile[FS_wav_number].File, FS_wav[PA_Channel], length, DMA_32NOW);
00391 
00392        <a class="code" href="group___sound_a_r_m9.html#ga13">PA_PlaySound</a>(PA_Channel, (<span class="keywordtype">void</span>*)FS_wav[PA_Channel], length &lt;&lt; 2, volume, freq);
00393 
00394        SndPlay(PA_Channel, (<span class="keywordtype">void</span>*)FS_wav[PA_Channel], length &lt;&lt; 2, volume, freq, 0, <span class="keyword">false</span>, 0);
00395 }
00396 
00397 
<a name="l00415"></a><a class="code" href="group___sound_a_r_m9.html#ga15">00415</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga15">PA_PlayFSSound</a>(u8 PA_Channel, u16 PAFS_wav_number, u8 volume, u32 freq){
00416        <a class="code" href="group___p_a_f_s.html#ga4">PA_Malloc</a>((<span class="keywordtype">void</span>**)(FS_wav[PA_Channel]), PA_FSFile[PAFS_wav_number].Length+4);
00417 
00418        s32 i;
00419        s32 length = (PA_FSFile[PAFS_wav_number].Length&gt;&gt;2) + 1; <span class="comment">// Pour etre sur...</span>
00420        <span class="keywordflow">for</span> (i = 0; i &lt; length; i++) FS_wav[PA_Channel][i] = ((u32*)<a class="code" href="group___p_a_f_s.html#ga5">PA_PAFSFile</a>(PAFS_wav_number))[i];
00421        
00422        <a class="code" href="group___sound_a_r_m9.html#ga13">PA_PlaySound</a>(PA_Channel, (<span class="keywordtype">void</span>*)FS_wav[PA_Channel], length &lt;&lt; 2, volume, freq);
00423 }
00424 
00425 
00426 
<a name="l00439"></a><a class="code" href="group___sound_a_r_m9.html#ga26">00439</a> <span class="preprocessor">#define PA_PlaySimpleSound(PA_Channel, sound) PA_PlaySoundEx(PA_Channel, (void*)sound, (u32)sound##_size, PA_SoundOption.volume, PA_SoundOption.freq, PA_SoundOption.format)</span>
00440 <span class="preprocessor"></span>
00441 
<a name="l00453"></a><a class="code" href="group___sound_a_r_m9.html#ga16">00453</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga16">PA_PlayGBFSSimpleSound</a>(u8 PA_Channel, u16 FS_wav_number){
00454 s32 length = (PA_GBFSfile[FS_wav_number].Length &gt;&gt; 2) + 1; <span class="comment">// Pour etre sur...</span>
00455        free(FS_wav[PA_Channel]);
00456        FS_wav[PA_Channel] = (u32*)malloc(length &lt;&lt; 2);
00457        
00458        DMA_Copy(PA_GBFSfile[FS_wav_number].File, FS_wav[PA_Channel], length, DMA_32NOW);
00459 
00460        <a class="code" href="group___sound_a_r_m9.html#ga13">PA_PlaySound</a>(PA_Channel, (<span class="keywordtype">void</span>*)FS_wav[PA_Channel], length &lt;&lt; 2, PA_SoundOption.volume, PA_SoundOption.freq);
00461 }
00462 
00463 
00464 
00465 
<a name="l00477"></a><a class="code" href="group___sound_a_r_m9.html#ga17">00477</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga17">PA_PlayFSSimpleSound</a>(u8 PA_Channel, u16 PAFS_wav_number){
00478        <a class="code" href="group___p_a_f_s.html#ga4">PA_Malloc</a>((<span class="keywordtype">void</span>**)(FS_wav[PA_Channel]), PA_FSFile[PAFS_wav_number].Length+4);
00479 
00480        s32 i;
00481        s32 length = (PA_FSFile[PAFS_wav_number].Length&gt;&gt;2) + 1; <span class="comment">// Pour etre sur...</span>
00482        <span class="keywordflow">for</span> (i = 0; i &lt; length; i++) FS_wav[PA_Channel][i] = ((u32*)<a class="code" href="group___p_a_f_s.html#ga5">PA_PAFSFile</a>(PAFS_wav_number))[i];
00483        
00484        <a class="code" href="group___sound_a_r_m9.html#ga13">PA_PlaySound</a>(PA_Channel, (<span class="keywordtype">void</span>*)FS_wav[PA_Channel], PA_FSFile[PAFS_wav_number].Length, PA_SoundOption.volume, PA_SoundOption.freq);
00485 }
00486 
00487 
00488 
00489 
00490 
00491 
<a name="l00500"></a><a class="code" href="group___sound_a_r_m9.html#ga27">00500</a> <span class="preprocessor">#define PA_PlayMod(mod_snd) SndPlayMOD((u8*)mod_snd)</span>
00501 <span class="preprocessor"></span>
00502 
<a name="l00511"></a><a class="code" href="group___sound_a_r_m9.html#ga18">00511</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga18">PA_PlayGBFSMod</a>(u16 FS_mod_number){
00512 s32 length = (PA_GBFSfile[FS_mod_number].Length &gt;&gt; 2) + 1; <span class="comment">// Pour etre sur...</span>
00513        free(FS_mod);
00514        FS_mod = (u32*)malloc(length &lt;&lt; 2);
00515 
00516        DMA_Copy(PA_GBFSfile[FS_mod_number].File, FS_mod, length, DMA_32NOW);
00517 
00518        <a class="code" href="group___sound_a_r_m9.html#ga27">PA_PlayMod</a>(FS_mod);
00519 }
00520 
00521 
<a name="l00530"></a><a class="code" href="group___sound_a_r_m9.html#ga19">00530</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga19">PA_PlayFSMod</a>(u16 PAFS_mod_number){
00531        <a class="code" href="group___p_a_f_s.html#ga4">PA_Malloc</a>((<span class="keywordtype">void</span>**)((u32)(&amp;FS_mod)), PA_FSFile[PAFS_mod_number].Length+4);
00532 
00533        s32 i;
00534        s32 length = (PA_FSFile[PAFS_mod_number].Length&gt;&gt;2) + 1; <span class="comment">// Pour etre sur...</span>
00535        <span class="keywordflow">for</span> (i = 0; i &lt; length; i++) FS_mod[i] = ((u32*)<a class="code" href="group___p_a_f_s.html#ga5">PA_PAFSFile</a>(PAFS_mod_number))[i];
00536        
00537        <a class="code" href="group___sound_a_r_m9.html#ga27">PA_PlayMod</a>(FS_mod);
00538 }
00539 
00540 
00541 
<a name="l00547"></a><a class="code" href="group___sound_a_r_m9.html#ga28">00547</a> <span class="preprocessor">#define PA_StopMod() SndStopMOD()</span>
00548 <span class="preprocessor"></span>
00549 
<a name="l00558"></a><a class="code" href="group___sound_a_r_m9.html#ga29">00558</a> <span class="preprocessor">#define PA_PauseMod(u8) SndPauseMOD(u8)</span>
00559 <span class="preprocessor"></span>
00560 
00561 
00570 <span class="keywordtype">void</span> PA_StopStream(u8 PA_Channel);
00571 
00580 <span class="keywordtype">void</span> PA_PauseStream(u8 PA_Channel);
00581 
00590 <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga22">PA_UnpauseStream</a>(u8 PA_Channel);
00591 
00592 
<a name="l00604"></a><a class="code" href="group___sound_a_r_m9.html#ga23">00604</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___sound_a_r_m9.html#ga23">PA_MicStartRecording</a>(u8* buffer, <span class="keywordtype">int</span> length){StartRecording(buffer, length);}
00605 
<a name="l00611"></a><a class="code" href="group___sound_a_r_m9.html#ga30">00611</a> <span class="preprocessor">#define PA_MicStopRecording() StopRecording()</span>
00612 <span class="preprocessor"></span>
00613 
00614 
00615 
<a name="l00624"></a><a class="code" href="group___sound_a_r_m9.html#ga24">00624</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___sound_a_r_m9.html#ga24">PA_SoundChannelIsBusy</a>(u8 PA_Channel)   {
00625        DC_FlushRange((<span class="keywordtype">void</span>*)PA_SoundsBusy, 16);
00626        <span class="keywordflow">return</span> ((<span class="keyword">volatile</span> u8)PA_SoundsBusy[PA_Channel]);
00627 }
00628 
<a name="l00634"></a><a class="code" href="group___sound_a_r_m9.html#ga25">00634</a> <span class="keyword">extern</span> <span class="keyword">inline</span> s8 <a class="code" href="group___sound_a_r_m9.html#ga25">PA_GetFreeSoundChannel</a>(<span class="keywordtype">void</span>){
00635        u8 i;
00636        <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++) <span class="keywordflow">if</span> (!<a class="code" href="group___sound_a_r_m9.html#ga24">PA_SoundChannelIsBusy</a>(i)) <span class="keywordflow">return</span> i;
00637        
00638        <span class="keywordflow">return</span> -1;
00639 }
00640 
00641  <span class="comment">// end of SoundARM9</span>
00643 
00670 <span class="comment">//void PA_PlayGBFSStreamSoundEx2(u8 PA_Channel, u16 FS_wav_number, u8 volume, int freq, s16 format, BOOL repeat, int repeatPoint);</span>
00671 
00672 
00673 
00674 
00675 
00676 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Généré le Sun Sep 17 18:20:40 2006 pour PAlib par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
