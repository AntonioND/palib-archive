<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PAlib:  Fichier source de PA_Math.h</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Généré par Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Page&nbsp;principale</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">Liste&nbsp;des&nbsp;fichiers</a> | <a class="qindex" href="globals.html">Portée&nbsp;globale</a>  | <span class="search">Rechercher&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>PA_Math.h</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef _PA_Math</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define _PA_Math</span>
00003 <span class="preprocessor"></span>
00004 <span class="preprocessor">#ifdef __cplusplus</span>
00005 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00006 <span class="preprocessor">#endif</span>
00007 <span class="preprocessor"></span>
00008 <span class="preprocessor">#include "PA9.h"</span>
00009 
00010 <span class="preprocessor">#include "<a class="code" href="_p_a___interrupt_8h.html">PA_Interrupt.h</a>"</span>
00011 
00012 
00013 
00014 <span class="keyword">typedef</span> <span class="keyword">struct</span>{
00015        u8 Screen;
00016        <span class="keywordtype">float</span> Time;
00017        s8 Functions;
00018        s32 Runs[16];
00019 }PA_TestInfos;
00020 <span class="keyword">extern</span> PA_TestInfos PA_TestInfo;
00021 
00022 <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> PA_TestInit(u8 screen, <span class="keywordtype">float</span> time){
00023        PA_TestInfo.Screen = screen;
00024        PA_TestInfo.Time = time*60; <span class="comment">// Convert seconds to VBLs</span>
00025        PA_TestInfo.Functions = 0; <span class="comment">// Functions tested</span>
00026 }
00027 
00028 <span class="preprocessor">#define PA_TESTSTART  { PA_OutputText(PA_TestInfo.Screen, 0, 4+PA_TestInfo.Functions, "Testing function %02d", PA_TestInfo.Functions+1);\</span>
00029 <span class="preprocessor">                            PA_WaitForVBL();\</span>
00030 <span class="preprocessor">                            PA_TestVBLs = 0;\</span>
00031 <span class="preprocessor">                            while( PA_TestVBLs &lt; PA_TestInfo.Time){</span>
00032 <span class="preprocessor"></span>
00033 
00034 <span class="preprocessor">#define PA_TESTEND  PA_TestInfo.Runs[PA_TestInfo.Functions] ++; }\</span>
00035 <span class="preprocessor">                                   PA_TestInfo.Functions++;} // 1 more function tested</span>
00036 <span class="preprocessor"></span>                                                        
00037 
00038 <span class="keywordtype">void</span> PA_TestResults(<span class="keywordtype">void</span>);
00039 
00040 
00041 
00042 
00043 
00044 
00045 
00046 
00047 
00048 
00049 
00050 
00051 
<a name="l00062"></a><a class="code" href="group___math.html#ga10">00062</a> <span class="preprocessor">#define PA_Cos(angle) PA_SIN[((angle) + 128)&amp;511]</span>
00063 <span class="preprocessor"></span>
00064 
<a name="l00070"></a><a class="code" href="group___math.html#ga11">00070</a> <span class="preprocessor">#define PA_Sin(angle) PA_SIN[((angle))&amp;511]</span>
00071 <span class="preprocessor"></span>
00072 
00073 
00074 
00075 <span class="keyword">extern</span> u16 RandomValue;  <span class="comment">// Seed pour la fonction random</span>
00076 
<a name="l00082"></a><a class="code" href="group___math.html#ga1">00082</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u32 <a class="code" href="group___math.html#ga1">PA_Rand</a>(<span class="keywordtype">void</span>) {
00083 <span class="keywordtype">int</span> i;
00084    RandomValue+=0x9248;
00085 
00086    <span class="keywordflow">for</span>(i=0;i&lt;3;i++)   {
00087        <span class="keywordflow">if</span>(RandomValue&amp;0x1) {
00088            RandomValue&gt;&gt;=1;
00089            RandomValue|=0x8000;
00090        }
00091        <span class="keywordflow">else</span>  RandomValue&gt;&gt;=1;
00092    }
00093    <span class="keywordflow">return</span>(RandomValue);
00094 }
00095 
00096 
00102 <span class="comment">// Les fonctions randoms sont prises de Ham, je n'ai strictement AUCUN mérite ! Désolé ! Je l'ai un peu modifiée, elle doit etre plus rapide</span>
<a name="l00103"></a><a class="code" href="group___math.html#ga2">00103</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___math.html#ga2">PA_InitRand</a>(<span class="keywordtype">void</span>) {
00104    RandomValue = PA_RTC.Minutes*60 + PA_RTC.Seconds + PA_RTC.Hour*3600 + PA_RTC.Day*3600*24+PA_RTC.Month*3600*24*30;
00105    <a class="code" href="group___math.html#ga1">PA_Rand</a>(); <a class="code" href="group___math.html#ga1">PA_Rand</a>(); <a class="code" href="group___math.html#ga1">PA_Rand</a>(); <span class="comment">// On fait plusieurs fois de base</span>
00106 }
00107 
00117 <span class="comment">// Les fonctions randoms sont prises de Ham, je n'ai strictement AUCUN mérite ! Désolé ! Je l'ai un peu modifiée, elle doit etre plus rapide</span>
<a name="l00118"></a><a class="code" href="group___math.html#ga3">00118</a> <span class="keyword">extern</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group___math.html#ga3">PA_SRand</a>(s32 r) {
00119    RandomValue = r;
00120 }
00121 
00122 
00123 
00124 
00125 
<a name="l00134"></a><a class="code" href="group___math.html#ga4">00134</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u32 <a class="code" href="group___math.html#ga4">PA_RandMax</a>(u32 max)
00135 {
00136     <span class="keywordflow">return</span> <a class="code" href="group___math.html#ga1">PA_Rand</a>()%(max + 1);
00137 }
00138 
00139 
00140 
<a name="l00152"></a><a class="code" href="group___math.html#ga5">00152</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u32 <a class="code" href="group___math.html#ga5">PA_RandMinMax</a>(u32 min,u32 max)
00153 {
00154     <span class="keywordflow">return</span> ((<a class="code" href="group___math.html#ga1">PA_Rand</a>()%((max + 1)-min)) + min);
00155 } 
00156 
00157 
<a name="l00175"></a><a class="code" href="group___math.html#ga6">00175</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u64 <a class="code" href="group___math.html#ga6">PA_Distance</a>(s32 x1, s32 y1, s32 x2, s32 y2) {
00176    s64 h = x1 - x2;
00177    s64 v = y1 - y2;
00178    <span class="keywordflow">return</span>(h*h + v*v);
00179 }
00180 
<a name="l00198"></a><a class="code" href="group___math.html#ga7">00198</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u64 <a class="code" href="group___math.html#ga7">PA_TrueDistance</a>(s32 x1, s32 y1, s32 x2, s32 y2) {
00199    s64 h = x1 - x2;
00200    s64 v = y1 - y2;
00201    <span class="keywordflow">return</span>(swiSqrt(h*h + v*v));
00202 }
00203 
00204 
00205 
00230 u16 <a class="code" href="group___math.html#ga8">PA_AdjustAngle</a>(u16 angle, s16 anglerot, s32 startx, s32 starty, s32 targetx, s32 targety);
00231 
00232 
00233 
<a name="l00251"></a><a class="code" href="group___math.html#ga9">00251</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u16 <a class="code" href="group___math.html#ga9">PA_GetAngle</a>(s32 startx, s32 starty, s32 targetx, s32 targety) {
00252 u16 angle = 0;
00253 u16 anglerot = 180;
00254 
00255 
00256 <span class="keywordflow">while</span>(anglerot &gt; 5) {
00257        angle = <a class="code" href="group___math.html#ga8">PA_AdjustAngle</a>(angle, anglerot, startx, starty, targetx, targety);
00258        anglerot = (anglerot - ((3 * anglerot) &gt;&gt; 3)); <span class="comment">// On diminue petit à petit la rotation...</span>
00259 }
00260 
00261 <span class="comment">// Ajustement encore plus précis...</span>
00262 anglerot = 4;
00263 angle = <a class="code" href="group___math.html#ga8">PA_AdjustAngle</a>(angle, anglerot, startx, starty, targetx, targety);
00264 anglerot = 2;
00265 angle = <a class="code" href="group___math.html#ga8">PA_AdjustAngle</a>(angle, anglerot, startx, starty, targetx, targety);
00266 anglerot = 1;
00267 angle = <a class="code" href="group___math.html#ga8">PA_AdjustAngle</a>(angle, anglerot, startx, starty, targetx, targety);
00268 
00269 <span class="keywordflow">return</span> angle;
00270 }
00271  <span class="comment">// end of Math</span>
00273 
00274 
00275 <span class="keyword">extern</span> <span class="keyword">inline</span> s32 PA_Modulo(s32 var, s32 modulo){
00276 <span class="keywordflow">while</span>(var &lt; 0) var += modulo;
00277 <span class="keywordflow">return</span> (var%modulo);
00278 }
00279 
00280 <span class="preprocessor">#ifdef __cplusplus</span>
00281 <span class="preprocessor"></span>}
00282 <span class="preprocessor">#endif</span>
00283 <span class="preprocessor"></span>
00284 <span class="preprocessor">#endif</span>
00285 <span class="preprocessor"></span>
00286 
</pre></div><hr size="1"><address style="align: right;"><small>Généré le Fri Oct 6 17:35:32 2006 pour PAlib par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
