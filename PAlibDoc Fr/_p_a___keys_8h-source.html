<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PAlib:  Fichier source de PA_Keys.h</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Généré par Doxygen 1.3.9.1 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="index.html">Page&nbsp;principale</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">Liste&nbsp;des&nbsp;fichiers</a> | <a class="qindex" href="globals.html">Portée&nbsp;globale</a>  | <span class="search">Rechercher&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<h1>PA_Keys.h</h1><a href="_p_a___keys_8h.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef _PA_KEYS</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define _PA_KEYS</span>
00003 <span class="preprocessor"></span>
00004 <span class="preprocessor">#ifdef __cplusplus</span>
00005 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00006 <span class="preprocessor">#endif</span>
00007 <span class="preprocessor"></span>
00008 <span class="preprocessor">#include "PA9.h"</span>
00014 
00015 <span class="comment">// Système pour les touches</span>
00017 <span class="comment"></span>
00018 <span class="comment">// Keyboard defines</span>
00019 <span class="preprocessor">#define PA_BACKSPACE 1    // On va dire que la touche backspace a pour valeur 1...</span>
00020 <span class="preprocessor"></span><span class="preprocessor">#define PA_CAPS      2    // 2 pour CAPS</span>
00021 <span class="preprocessor"></span><span class="preprocessor">#define PA_ENTER     '\n'    // 3 pour Enter</span>
00022 <span class="preprocessor"></span><span class="preprocessor">#define PA_SHIFT     4    // etc</span>
00023 <span class="preprocessor"></span><span class="preprocessor">#define PA_RIEN      0    // Si y'a rien, faudra faire comme si on appuye sur rien</span>
00024 <span class="preprocessor"></span><span class="preprocessor">#define PA_TAB       3    // tab...</span>
00025 <span class="preprocessor"></span>
00026 <span class="comment">// Stylus and Pad definitions, will be used by the arm7 to auto-update positions...</span>
00027 
00028 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00029    u8 A, B, X, Y, L, R, Up, Down, Right, Left, Start, Select, Anykey;
00030 } PA_Pad;
00031 
00032 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00033    PA_Pad Held, Released, Newpress; <span class="comment">// Pressed si on appuye, Held si on garde appuyé, et Released si on relache</span>
00034 } Pads;
00035 
00036 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00037    u8 Held, Released, Newpress, Newpress0;
00038    s16 X, Y, altX, altY, Pressure, Vx, Vy, oldVx, oldVy, Downtime, Uptime, DblClick;
00039 } PA_Stylus;
00040 
00041 
00042 <span class="keyword">extern</span> PA_Stylus Stylus;
00043 
00044 <span class="keyword">extern</span> Pads Pad;
00045 <span class="keyword">extern</span> PA_Pad* PadPointer;
00046 
00047 <span class="comment">// Structure pour les sprites que l'on déplace...</span>
00048 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00049        u8 Moving;
00050        u8 Sprite;
00051        s16 X, Y, Vx, Vy, NextVx, NextVy;
00052        u8 Time; <span class="comment">// Si trop longtemps sans bouger le sprite, il décroche...</span>
00053 } PA_movingsprite;
00054 
00055 <span class="keyword">extern</span> PA_movingsprite PA_MovedSprite;
00056 
00057 <span class="keyword">extern</span> u8 PA_MoveSpriteType; 
00058 
00059 
00060 <span class="comment">// Button info</span>
00061 
00062 
00063 
00064 
00065 
00066 <span class="comment">/*</span>
00067 <span class="comment">#define PA_UpdatePad() ExPad = CompletePad;\</span>
00068 <span class="comment">   CompletePad = ~(BUTTONS + (((IPC-&gt;buttons)&amp;3) &lt;&lt; 10));\</span>
00069 <span class="comment">   UPDATEPAD(Pad.Held, CompletePad);\</span>
00070 <span class="comment">   UPDATEPAD(Pad.Released, (ExPad &amp; (~CompletePad)));\</span>
00071 <span class="comment">   UPDATEPAD(Pad.Newpress, (CompletePad &amp; (~ExPad)));</span>
00072 <span class="comment"></span>
00073 <span class="comment">#define PA_UpdateStylus() u8 temp = ((~IPC-&gt;buttons) &gt;&gt; 6) &amp; 1;\</span>
00074 <span class="comment">       Stylus.Newpress = temp &amp; (!Stylus.Held);\</span>
00075 <span class="comment">       Stylus.Released = (!temp) &amp; Stylus.Held;\</span>
00076 <span class="comment">       Stylus.Held = temp;\</span>
00077 <span class="comment">       if(Stylus.Held)Stylus.altX =  ((IPC-&gt;touchX - 0x0113) / 14);\</span>
00078 <span class="comment">       if(Stylus.Held)Stylus.altY =  ((IPC-&gt;touchY - 0x00E0) / 19);\</span>
00079 <span class="comment">       if(Stylus.Held)Stylus.X =  IPC-&gt;touchXpx;\</span>
00080 <span class="comment">       if(Stylus.Held)Stylus.Y =  IPC-&gt;touchYpx;\</span>
00081 <span class="comment">       if(Stylus.Held)Stylus.Pressure = (((Stylus.X * IPC-&gt;touchZ2) &gt;&gt; 6) / IPC-&gt;touchZ1) - (Stylus.X &gt;&gt; 6);</span>
00082 <span class="comment">*/</span>
00083 <span class="comment">//#define BUTTON_AND 16384</span>
00084 <span class="comment">//#define BUTTON_OR 0</span>
00085 
00099 <span class="keywordtype">void</span> <a class="code" href="group___keys.html#ga0">PA_UpdatePad</a>(<span class="keywordtype">void</span>);
00100 
00101 
00102 
00109 <span class="keywordtype">void</span> <a class="code" href="group___keys.html#ga1">PA_UpdateStylus</a>(<span class="keywordtype">void</span>);
00110 
00111 
00120 u8 <a class="code" href="group___keys.html#ga2">PA_MoveSpritePix</a>(u8 sprite);
00121 
00122 
00123 
00124 
00125 
00126 
00127 
<a name="l00136"></a><a class="code" href="group___keys.html#ga11">00136</a> <span class="preprocessor">#define PA_MoveSprite(sprite) PA_MoveSpriteEx(PA_Screen, sprite, PA_GetSpriteLx(0, sprite), PA_GetSpriteLy(0, sprite))</span>
00137 <span class="preprocessor"></span>
00138 
00139 
00157 u8 <a class="code" href="group___keys.html#ga3">PA_MoveSpriteEx</a>(u8 screen, u8 sprite, u8 lx, u8 ly);
00158 
00159 
<a name="l00171"></a><a class="code" href="group___keys.html#ga4">00171</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___keys.html#ga4">PA_MoveSpriteDistance</a>(u8 sprite, u8 distance){
00172        PA_MoveSpriteType = 1; <span class="comment">// mode distance</span>
00173        u8 touched = <a class="code" href="group___keys.html#ga3">PA_MoveSpriteEx</a>(PA_Screen, sprite, distance, distance);
00174        PA_MoveSpriteType = 0; <span class="comment">// normal mode</span>
00175        <span class="keywordflow">return</span> touched;
00176 }
00177 <span class="comment">/*</span>
00184 <span class="comment">extern inline void PA_UpdateMoveSprite(void) {</span>
00185 <span class="comment">       PA_MovedSprite.Time++;</span>
00186 <span class="comment">       if ((PA_MovedSprite.Time &gt; 2) || Stylus.Released) {</span>
00187 <span class="comment">              PA_MovedSprite.Moving = 0;</span>
00188 <span class="comment">              PA_MovedSprite.Time = 0;</span>
00189 <span class="comment">       }</span>
00190 <span class="comment">}*/</span>
00191 
00192 
<a name="l00208"></a><a class="code" href="group___keys.html#ga5">00208</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___keys.html#ga5">PA_SpriteStylusOverEx</a>(u8 sprite, u8 lx, u8 ly){
00209        <span class="keywordflow">return</span> ((Stylus.X &gt; <a class="code" href="group___sprite.html#ga44">PA_GetSpriteX</a>(PA_Screen, sprite)) &amp;&amp; (Stylus.X &lt; <a class="code" href="group___sprite.html#ga44">PA_GetSpriteX</a>(PA_Screen, sprite) + lx)&amp;&amp; (Stylus.Y &gt; <a class="code" href="group___sprite.html#ga46">PA_GetSpriteY</a>(PA_Screen, sprite)) &amp;&amp; (Stylus.Y &lt; <a class="code" href="group___sprite.html#ga46">PA_GetSpriteY</a>(PA_Screen, sprite) + ly));
00210 }
00211 
00212 
00213 
<a name="l00229"></a><a class="code" href="group___keys.html#ga6">00229</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___keys.html#ga6">PA_SpriteTouchedEx</a>(u8 sprite, u8 lx, u8 ly){
00230        <span class="keywordflow">return</span> (Stylus.Held &amp;&amp; <a class="code" href="group___keys.html#ga5">PA_SpriteStylusOverEx</a>(sprite, lx, ly));
00231 }
00232 
00233 
00234 
<a name="l00243"></a><a class="code" href="group___keys.html#ga7">00243</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___keys.html#ga7">PA_SpriteTouched</a>(u8 sprite) {
00244        <span class="keywordflow">return</span> <a class="code" href="group___keys.html#ga6">PA_SpriteTouchedEx</a>(sprite, <a class="code" href="group___sprite.html#ga65">PA_GetSpriteLx</a>(PA_Screen, sprite), <a class="code" href="group___sprite.html#ga66">PA_GetSpriteLy</a>(PA_Screen, sprite));
00245 }
00246 
00247 
00248 
<a name="l00257"></a><a class="code" href="group___keys.html#ga8">00257</a> <span class="keyword">extern</span> <span class="keyword">inline</span> u8 <a class="code" href="group___keys.html#ga8">PA_SpriteStylusOver</a>(u8 sprite) {
00258        <span class="keywordflow">return</span> <a class="code" href="group___keys.html#ga5">PA_SpriteStylusOverEx</a>(sprite, <a class="code" href="group___sprite.html#ga65">PA_GetSpriteLx</a>(PA_Screen, sprite), <a class="code" href="group___sprite.html#ga66">PA_GetSpriteLy</a>(PA_Screen, sprite));
00259 }
00260 
00261 
00262 
00263 <span class="keyword">extern</span> <span class="keyword">inline</span> u8 PA_SpriteTouchedPix(u8 sprite){
00264        s16 spritex = <a class="code" href="group___sprite.html#ga44">PA_GetSpriteX</a>(PA_Screen, sprite);
00265        s16 spritey = <a class="code" href="group___sprite.html#ga46">PA_GetSpriteY</a>(PA_Screen, sprite);
00266        <span class="keywordflow">if</span> (spritex &gt;= 458) spritex -=511; <span class="comment">// normalize the X coordinate...</span>
00267        <span class="keywordflow">if</span> (spritey &gt;= 220) spritey -=256; <span class="comment">// normalize the y coordinate...</span>
00268        u16 x = Stylus.X - spritex;
00269        u16 y = Stylus.Y - spritey;
00270        
00271        <span class="keywordflow">return</span> (Stylus.Held &amp;&amp; (x &lt; spriteanims[PA_Screen][sprite].lx) &amp;&amp; (y &lt; spriteanims[PA_Screen][sprite].ly) &amp;&amp; <a class="code" href="group___sprite.html#ga32">PA_GetSpritePixel</a>(PA_Screen, sprite, x, y));
00272 }
00273 
00274 
00275 <span class="keyword">extern</span> <span class="keyword">inline</span> u8 PA_Sprite16cTouchedPix(u8 sprite){
00276        s16 spritex = <a class="code" href="group___sprite.html#ga44">PA_GetSpriteX</a>(PA_Screen, sprite);
00277        s16 spritey = <a class="code" href="group___sprite.html#ga46">PA_GetSpriteY</a>(PA_Screen, sprite);
00278        <span class="keywordflow">if</span> (spritex &gt;= 458) spritex -=511; <span class="comment">// normalize the X coordinate...</span>
00279        <span class="keywordflow">if</span> (spritey &gt;= 220) spritey -=256; <span class="comment">// normalize the y coordinate...</span>
00280        u16 x = Stylus.X - spritex;
00281        u16 y = Stylus.Y - spritey;
00282        
00283        <span class="keywordflow">return</span> (Stylus.Held &amp;&amp; (x &lt; spriteanims[PA_Screen][sprite].lx) &amp;&amp; (y &lt; spriteanims[PA_Screen][sprite].ly) &amp;&amp; <a class="code" href="group___sprite.html#ga33">PA_GetSprite16cPixel</a>(PA_Screen, sprite, x, y));
00284 }
00285 
<a name="l00303"></a><a class="code" href="group___keys.html#ga12">00303</a> <span class="preprocessor">#define PA_StylusInZone(x1, y1, x2, y2) ((Stylus.X&gt;=x1)&amp;&amp;(Stylus.Y&gt;=y1)&amp;&amp;(Stylus.X&lt;x2)&amp;&amp;(Stylus.Y&lt;y2))</span>
00304 <span class="preprocessor"></span> <span class="comment">// end of Keys</span>
00306 
00307 
00308 
00309 
00310 
00311 
00312 
00313 
00314 
00315 
00316 
00317 
00318 <span class="preprocessor">#ifdef __cplusplus</span>
00319 <span class="preprocessor"></span>}
00320 <span class="preprocessor">#endif</span>
00321 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Généré le Tue Jan 30 23:10:49 2007 pour PAlib par&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
